# Pre-commit hooks –¥–ª—è {{PROJECT_NAME}}
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞: pip install pre-commit && pre-commit install
#
# –í–∫–ª—é—á–∞–µ—Ç:
# - –ü—Ä–æ–≤–µ—Ä–∫—É —Å–µ–∫—Ä–µ—Ç–æ–≤ (gitleaks, detect-secrets)
# - –õ–∏–Ω—Ç–∏–Ω–≥ Python (ruff)
# - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (ruff format)
# - –ü—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤ (mypy)
# - –í–∞–ª–∏–¥–∞—Ü–∏—é YAML/JSON

repos:
  # ============================================================================
  # SECURITY: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –∫–æ–¥–µ
  # ============================================================================

  # Gitleaks ‚Äî –±—ã—Å—Ç—Ä—ã–π —Å–∫–∞–Ω–µ—Ä —Å–µ–∫—Ä–µ—Ç–æ–≤
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.18.1
    hooks:
      - id: gitleaks
        name: "üîê Detect secrets with gitleaks"
        description: "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ (API keys, passwords, tokens)"
        # –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å .env.example —Ñ–∞–π–ª—ã (–æ–Ω–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç placeholder'—ã)
        exclude: \.env\.example$

  # Detect-secrets ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–∫–∞–Ω–µ—Ä –æ—Ç Yelp
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.4.0
    hooks:
      - id: detect-secrets
        name: "üîë Detect secrets with detect-secrets"
        args:
          - "--baseline"
          - ".secrets.baseline"
        # –ò—Å–∫–ª—é—á–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –∏ –ø—Ä–∏–º–µ—Ä—ã
        exclude: |
          (?x)^(
            .*\.env\.example$|
            .*test_.*\.py$|
            .*_test\.py$|
            \.secrets\.baseline$
          )$

  # ============================================================================
  # PYTHON: –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
  # ============================================================================

  # Ruff ‚Äî –±—ã—Å—Ç—Ä—ã–π –ª–∏–Ω—Ç–µ—Ä –∏ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.1.9
    hooks:
      # –õ–∏–Ω—Ç–∏–Ω–≥
      - id: ruff
        name: "üîç Lint Python with ruff"
        args: ["--fix", "--exit-non-zero-on-fix"]
      # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
      - id: ruff-format
        name: "‚ú® Format Python with ruff"

  # Mypy ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        name: "üìù Type check with mypy"
        additional_dependencies:
          - pydantic
          - pydantic-settings
          - fastapi
          - structlog
        args:
          - "--ignore-missing-imports"
          - "--no-error-summary"
        # –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º services/
        files: ^services/.*\.py$

  # ============================================================================
  # GENERAL: –û–±—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
  # ============================================================================

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # –ó–∞–ø—Ä–µ—Ç –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
      - id: check-added-large-files
        name: "üì¶ Check for large files"
        args: ["--maxkb=500"]

      # –ü—Ä–æ–≤–µ—Ä–∫–∞ YAML —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
      - id: check-yaml
        name: "üìÑ Validate YAML"
        args: ["--unsafe"]  # –†–∞–∑—Ä–µ—à–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–µ–≥–∏

      # –ü—Ä–æ–≤–µ—Ä–∫–∞ JSON —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
      - id: check-json
        name: "üìÑ Validate JSON"

      # –ü—Ä–æ–≤–µ—Ä–∫–∞ TOML —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
      - id: check-toml
        name: "üìÑ Validate TOML"

      # –ó–∞–ø—Ä–µ—Ç –∫–æ–º–º–∏—Ç–∞ –≤ main/master –Ω–∞–ø—Ä—è–º—É—é
      - id: no-commit-to-branch
        name: "üö´ Prevent direct commits to main"
        args: ["--branch", "main", "--branch", "master"]

      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ü–∞ —Ñ–∞–π–ª–∞
      - id: end-of-file-fixer
        name: "üìù Fix end of file"

      # –£–¥–∞–ª–µ–Ω–∏–µ trailing whitespace
      - id: trailing-whitespace
        name: "üßπ Remove trailing whitespace"

      # –ü—Ä–æ–≤–µ—Ä–∫–∞ merge conflict –º–∞—Ä–∫–µ—Ä–æ–≤
      - id: check-merge-conflict
        name: "‚ö†Ô∏è Check for merge conflicts"

      # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ .env —Ñ–∞–π–ª—ã –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è
      - id: check-case-conflict
        name: "üî§ Check case conflicts"

  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è
  - repo: local
    hooks:
      - id: check-secrets-files
        name: "üö´ Block secret files from commit"
        entry: bash -c 'echo "ERROR: Attempting to commit secret files!" && exit 1'
        language: system
        files: |
          (?x)^(
            .*\.env$|
            .*\.env\.local$|
            .*\.env\.[^.]+\.local$|
            .*\.pem$|
            .*\.key$|
            .*credentials\.json$|
            .*secrets\.json$|
            .*service-account\.json$
          )$
        pass_filenames: false

  # ============================================================================
  # DOCKER: –ü—Ä–æ–≤–µ—Ä–∫–∞ Dockerfile
  # ============================================================================

  - repo: https://github.com/hadolint/hadolint
    rev: v2.12.0
    hooks:
      - id: hadolint-docker
        name: "üê≥ Lint Dockerfile"
        args:
          - "--ignore"
          - "DL3008"  # –í–µ—Ä—Å–∏–∏ apt –ø–∞–∫–µ—Ç–æ–≤
          - "--ignore"
          - "DL3013"  # –í–µ—Ä—Å–∏–∏ pip –ø–∞–∫–µ—Ç–æ–≤

# ============================================================================
# CI Integration
# ============================================================================
# –î–æ–±–∞–≤—å—Ç–µ –≤ GitHub Actions:
#
# - name: Run pre-commit
#   uses: pre-commit/action@v3.0.0
#   with:
#     extra_args: --all-files
#
# ============================================================================
