---
# === YAML Frontmatter (машиночитаемые метаданные) ===
feature_id: "{FID}"
feature_name: "{slug}"
title: "Review Report: {Название проекта/фичи}"
created: "{YYYY-MM-DD}"
author: "AI (Reviewer)"
type: "review"
status: "REVIEW_OK"                    # Draft → REVIEW_OK | REVIEW_FAILED
version: 1

# Ссылки на связанные артефакты
prd_ref: "prd/{YYYY-MM-DD}_{FID}_{slug}-prd.md"
plan_ref: "architecture/{YYYY-MM-DD}_{FID}_{slug}-plan.md"

# Результаты ревью
issues_count:
  critical: 0
  major: 0
  minor: 0
coverage_percent: 0
---

# Review Report: {Название проекта/фичи}

**Feature ID**: {FID}
**Версия**: 1.0
**Дата ревью**: {YYYY-MM-DD}
**Автор**: AI Agent (Ревьюер)
**Статус**: Passed | Passed with Comments | Failed

---

## 1. Сводка

### 1.1 Результат ревью

| Категория | Статус | Критических | Важных | Незначительных |
|-----------|--------|-------------|--------|----------------|
| Архитектура | ✅/⚠️/❌ | {N} | {N} | {N} |
| Код | ✅/⚠️/❌ | {N} | {N} | {N} |
| Тесты | ✅/⚠️/❌ | {N} | {N} | {N} |
| Безопасность | ✅/⚠️/❌ | {N} | {N} | {N} |
| Документация | ✅/⚠️/❌ | {N} | {N} | {N} |
| **ИТОГО** | **{Статус}** | **{N}** | **{N}** | **{N}** |

### 1.2 Общая оценка

{Краткое резюме качества реализации}

---

## 2. Проверка архитектуры

### 2.1 Соответствие принципам

| Принцип | Соответствует | Комментарий |
|---------|--------------|-------------|
| Hexagonal Architecture | ✅/❌ | {Комментарий} |
| HTTP-only Data Access | ✅/❌ | {Комментарий} |
| DDD структура | ✅/❌ | {Комментарий} |
| Single Responsibility | ✅/❌ | {Комментарий} |

### 2.2 Замечания по архитектуре

#### ARCH-001: {Название} — {Критичность}

**Файл**: `{path/to/file.py}`
**Строки**: {NN-MM}

**Проблема**:
{Описание проблемы}

**Рекомендация**:
```python
# Текущий код
{current_code}

# Рекомендуемый код
{recommended_code}
```

---

## 3. Проверка кода

### 3.1 Качество кода

| Критерий | Оценка | Комментарий |
|----------|--------|-------------|
| Именование | ✅/⚠️/❌ | {Комментарий} |
| Типизация | ✅/⚠️/❌ | {Комментарий} |
| Документация | ✅/⚠️/❌ | {Комментарий} |
| Обработка ошибок | ✅/⚠️/❌ | {Комментарий} |
| DRY/KISS/YAGNI | ✅/⚠️/❌ | {Комментарий} |

### 3.2 Замечания по коду

#### CODE-001: {Название} — {Критичность}

**Файл**: `{path/to/file.py}`
**Строки**: {NN-MM}

**Проблема**:
{Описание проблемы}

**Текущий код**:
```python
{current_code}
```

**Рекомендация**:
```python
{recommended_code}
```

**Обоснование**:
{Почему это важно исправить}

---

## 4. Проверка тестов

### 4.1 Покрытие

| Сервис | Coverage | Требуется | Статус |
|--------|----------|-----------|--------|
| {context}_api | {XX}% | 75% | ✅/❌ |
| {context}_data | {XX}% | 75% | ✅/❌ |

### 4.2 Качество тестов

| Критерий | Оценка | Комментарий |
|----------|--------|-------------|
| Unit тесты | ✅/⚠️/❌ | {Комментарий} |
| Integration тесты | ✅/⚠️/❌ | {Комментарий} |
| Изоляция | ✅/⚠️/❌ | {Комментарий} |
| Edge cases | ✅/⚠️/❌ | {Комментарий} |

### 4.3 Замечания по тестам

#### TEST-001: {Название} — {Критичность}

**Файл**: `{path/to/test_file.py}`

**Проблема**:
{Описание проблемы}

**Рекомендация**:
{Рекомендуемое исправление}

---

## 5. Проверка безопасности

### 5.1 OWASP Top 10

| Проверка | Статус | Комментарий |
|----------|--------|-------------|
| SQL Injection | ✅/❌ | {Комментарий} |
| XSS | ✅/❌ | {Комментарий} |
| CSRF | ✅/❌ | {Комментарий} |
| Auth/AuthZ | ✅/⚠️/❌ | {Комментарий} |
| Dependencies | ✅/⚠️/❌ | {Комментарий} |

### 5.2 Secrets Management Checklist

> **Документация**: `knowledge/security/security-checklist.md`

#### BLOCKER (блокирует REVIEW_OK)

| # | Проверка | Статус | Комментарий |
|---|----------|--------|-------------|
| 1 | .gitignore содержит .env | ✅/❌ | |
| 2 | Нет hardcoded паролей в коде | ✅/❌ | |
| 3 | Нет hardcoded токенов в коде | ✅/❌ | |
| 4 | .env.example без реальных секретов | ✅/❌ | |

#### CRITICAL (требует исправления)

| # | Проверка | Статус | Комментарий |
|---|----------|--------|-------------|
| 5 | .gitignore содержит *.pem, *.key | ✅/❌ | |
| 6 | docker-compose без default паролей (:-) | ✅/❌ | |
| 7 | Нет прямого логирования секретов | ✅/❌ | |
| 8 | CI/CD использует ${{ secrets.* }} | ✅/❌ | |

#### WARNING (рекомендуется исправить)

| # | Проверка | Статус | Комментарий |
|---|----------|--------|-------------|
| 9 | Pre-commit hooks настроены | ✅/⚠️ | |
| 10 | Gitleaks hook активен | ✅/⚠️ | |
| 11 | .env.example содержит CHANGE_ME | ✅/⚠️ | |
| 12 | Settings без default секретов | ✅/⚠️ | |

### 5.3 Log-Driven Design Security

| # | Проверка | Статус | Комментарий |
|---|----------|--------|-------------|
| 1 | structlog с sanitize_sensitive_data | ✅/❌ | |
| 2 | Секретные поля маскируются в логах | ✅/❌ | |
| 3 | Нет антипаттернов логирования | ✅/⚠️ | |

### 5.4 Замечания по безопасности

#### SEC-001: {Название} — {BLOCKER/CRITICAL/WARNING}

**Файл**: `{path/to/file.py}`
**Строки**: {NN-MM}

**Проблема**:
{Описание уязвимости}

**Риск**:
{Что может произойти}

**Исправление**:
```python
{fix_code}
```

---

## 6. Соответствие конвенциям

### 6.1 Чеклист конвенций

| Конвенция | Соответствует | Файлы с нарушениями |
|-----------|--------------|---------------------|
| snake_case naming | ✅/❌ | {файлы} |
| Google docstrings | ✅/❌ | {файлы} |
| Type hints | ✅/❌ | {файлы} |
| Import ordering | ✅/❌ | {файлы} |
| Max line length | ✅/❌ | {файлы} |

---

## 7. Трассировка требований

### 7.1 Покрытие требований

| Требование | Реализовано | Тест | Статус |
|------------|-------------|------|--------|
| FR-001 | ✅/❌ | ✅/❌ | ✅/❌ |
| FR-002 | ✅/❌ | ✅/❌ | ✅/❌ |
| FR-003 | ✅/❌ | ✅/❌ | ✅/❌ |
| NF-001 | ✅/❌ | ✅/❌ | ✅/❌ |

### 7.2 Непокрытые требования

| Требование | Причина | Рекомендация |
|------------|---------|--------------|
| {FR-XXX} | {Причина} | {Действие} |

---

## 8. Список замечаний

### 8.1 Критические (блокируют релиз)

| ID | Категория | Файл | Описание |
|----|-----------|------|----------|
| {ID} | {Категория} | {Файл} | {Краткое описание} |

### 8.2 Важные (должны быть исправлены)

| ID | Категория | Файл | Описание |
|----|-----------|------|----------|
| {ID} | {Категория} | {Файл} | {Краткое описание} |

### 8.3 Незначительные (рекомендации)

| ID | Категория | Файл | Описание |
|----|-----------|------|----------|
| {ID} | {Категория} | {Файл} | {Краткое описание} |

---

## 9. Рекомендации

### 9.1 Обязательные действия

1. {Действие 1}
2. {Действие 2}
3. {Действие 3}

### 9.2 Улучшения на будущее

1. {Улучшение 1}
2. {Улучшение 2}

---

## 10. Заключение

**Итоговый статус**: {Passed | Passed with Comments | Failed}

**Условия для прохождения**:
- [ ] Критические замечания исправлены
- [ ] Важные замечания исправлены или запланированы
- [ ] Coverage ≥ 75%
- [ ] Нет блокирующих security issues

---

## Качественные ворота

### REVIEW_PASSED Checklist

- [ ] Нет критических замечаний
- [ ] Архитектура соответствует принципам
- [ ] Код соответствует конвенциям
- [ ] Coverage ≥ 75%
- [ ] Нет security vulnerabilities
- [ ] Все требования трассируются
