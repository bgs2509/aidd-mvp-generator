---
# === YAML Frontmatter (машиночитаемые метаданные) ===
# Заполняется автоматически при создании артефакта

feature_id: "{FID}"                    # F001, F002, ... (автогенерация)
feature_name: "{slug}"                 # kebab-case, ≤30 символов
title: "{Название проекта/фичи}"
created: "{YYYY-MM-DD}"                # Дата создания
author: "AI (Analyst)"
type: "prd"
status: "PRD_READY"                    # Draft → PRD_READY
version: 1
mode: "{CREATE|FEATURE}"

# Опционально (заполняется по мере работы)
related_features: []                   # [F001, F003] — связанные фичи
services: []                           # [booking_api, booking_data]
requirements_count: 0                  # Количество FR-* требований

# Пайплайны
pipelines:
  business: true                       # Есть бизнес-пайплайн
  data: true                           # Есть data pipeline
  integration: true                    # Есть интеграции
  modified: []                         # [pipeline1, pipeline2] — для FEATURE
---

# PRD: {Название проекта/фичи}

**Feature ID**: {FID}
**Версия**: 1.0
**Дата**: {YYYY-MM-DD}
**Автор**: AI Agent (Аналитик)
**Статус**: Draft | Review | Approved

---

## 1. Обзор

### 1.1 Проблема

{Описание проблемы, которую решает проект/фича}

- Какую боль испытывает пользователь?
- Почему текущее решение неудовлетворительно?
- Какие последствия нерешённой проблемы?

### 1.2 Решение

{Краткое описание предлагаемого решения}

- Как решение устраняет проблему?
- Ключевые компоненты решения
- Ожидаемый результат

### 1.3 Целевая аудитория

| Сегмент | Описание | Потребности |
|---------|----------|-------------|
| {Сегмент 1} | {Описание} | {Что им нужно} |
| {Сегмент 2} | {Описание} | {Что им нужно} |

### 1.4 Ценностное предложение

{Почему пользователь выберет это решение}

---

## 2. Функциональные требования

### 2.1 Core Features (Must Have)

| ID | Название | Описание | Критерий приёмки |
|----|----------|----------|------------------|
| FR-001 | {Название} | {Детальное описание функции} | {Как проверить, что реализовано} |
| FR-002 | {Название} | {Детальное описание функции} | {Как проверить, что реализовано} |
| FR-003 | {Название} | {Детальное описание функции} | {Как проверить, что реализовано} |

### 2.2 Important Features (Should Have)

| ID | Название | Описание | Критерий приёмки |
|----|----------|----------|------------------|
| FR-010 | {Название} | {Детальное описание функции} | {Как проверить, что реализовано} |
| FR-011 | {Название} | {Детальное описание функции} | {Как проверить, что реализовано} |

### 2.3 Nice to Have (Could Have)

| ID | Название | Описание | Критерий приёмки |
|----|----------|----------|------------------|
| FR-020 | {Название} | {Детальное описание функции} | {Как проверить, что реализовано} |

---

## 3. User Stories

### US-001: {Название истории}

**Как** {роль пользователя}
**Я хочу** {действие}
**Чтобы** {цель/выгода}

**Критерии приёмки:**
- [ ] {Критерий 1}
- [ ] {Критерий 2}
- [ ] {Критерий 3}

**Связанные требования:** FR-001, FR-002

---

### US-002: {Название истории}

**Как** {роль пользователя}
**Я хочу** {действие}
**Чтобы** {цель/выгода}

**Критерии приёмки:**
- [ ] {Критерий 1}
- [ ] {Критерий 2}

**Связанные требования:** FR-003

---

## 4. Пайплайны

### 4.0 Тип изменений

| Параметр | Значение |
|----------|----------|
| Режим | CREATE (новый) / FEATURE (изменение) |
| Затрагиваемые пайплайны | {список или "все новые"} |

### 4.1 Бизнес-пайплайн

> Последовательность бизнес-операций и состояний сущностей

**Основной flow:**

```
[Событие] → [Валидация] → [Обработка] → [Результат] → [Уведомление]
```

| # | Этап | Описание | Условия перехода | Результат |
|---|------|----------|------------------|-----------|
| 1 | {Этап} | {Что происходит} | {Когда переходим} | {Что получаем} |

**Состояния сущностей:**

| Сущность | Состояния | Переходы |
|----------|-----------|----------|
| {Сущность} | draft → pending → confirmed → completed | {Правила перехода} |

### 4.2 Data Pipeline

> Поток данных между компонентами системы

**Диаграмма потока данных:**

```
┌─────────┐     HTTP      ┌─────────────┐     HTTP     ┌──────────┐
│ Client  │ ────────────▶ │ Business API│ ───────────▶ │ Data API │
└─────────┘               └─────────────┘              └──────────┘
                                │                            │
                                │ async                      │ SQL
                                ▼                            ▼
                          ┌──────────┐               ┌────────────┐
                          │  Queue   │               │ PostgreSQL │
                          └──────────┘               └────────────┘
                                │
                                ▼
                          ┌──────────┐
                          │  Worker  │
                          └──────────┘
```

| # | Источник | Назначение | Данные | Формат | Синхронность |
|---|----------|------------|--------|--------|--------------|
| 1 | {От} | {К} | {Что передаётся} | JSON/Protobuf | sync/async |

**Трансформации данных:**

| # | Точка | Входные данные | Преобразование | Выходные данные |
|---|-------|----------------|----------------|-----------------|
| 1 | {Где} | {Input DTO} | {Что делаем} | {Output DTO} |

### 4.3 Интеграционный пайплайн

> Взаимодействие между сервисами и внешними системами

**Карта сервисов:**

```
┌─────────────────────────────────────────────────────────────┐
│                         СИСТЕМА                             │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────────┐       ┌──────────────┐                    │
│  │ Business API │◄─────►│   Data API   │                    │
│  └──────┬───────┘       └──────────────┘                    │
│         │                                                    │
│         ▼                                                    │
│  ┌──────────────┐       ┌──────────────┐                    │
│  │ Telegram Bot │       │    Worker    │                    │
│  └──────────────┘       └──────────────┘                    │
└─────────────────────────────────────────────────────────────┘
          │                       │
          ▼                       ▼
    ┌───────────┐          ┌────────────┐
    │ Telegram  │          │ External   │
    │    API    │          │  Service   │
    └───────────┘          └────────────┘
```

**Точки интеграции:**

| ID | От | К | Протокол | Endpoint | Описание |
|----|----|----|----------|----------|----------|
| INT-001 | Business API | Data API | HTTP/REST | /api/v1/* | CRUD операции |
| INT-002 | Bot | Business API | HTTP/REST | /api/v1/* | Команды бота |
| INT-003 | Worker | External | HTTP/REST | {URL} | {Описание} |

**Контракты API:**

| Интеграция | Request | Response | Ошибки |
|------------|---------|----------|--------|
| INT-001 | {Schema} | {Schema} | 4xx, 5xx |

### 4.4 Влияние на существующие пайплайны

> Заполняется ВСЕГДА. Для CREATE: "Новая система". Для FEATURE: таблица изменений.

**Режим:** CREATE / FEATURE

**Для CREATE:**
```
Новая система — существующих пайплайнов нет.
Все пайплайны создаются с нуля согласно разделам 4.1-4.3.
```

**Для FEATURE:**

| Пайплайн | Тип изменения | Затрагиваемые этапы | Обратная совместимость |
|----------|---------------|---------------------|------------------------|
| {Название} | add/modify/remove | {Этапы} | Да/Нет (причина) |

**Breaking changes:**
- [ ] Нет breaking changes
- [ ] {Описание breaking change и план миграции}

---

## 5. UI/UX требования

### 5.1 Экраны и интерфейсы

| ID | Экран | Описание | Приоритет |
|----|-------|----------|-----------|
| UI-001 | {Название экрана} | {Описание назначения и ключевых элементов} | Must |
| UI-002 | {Название экрана} | {Описание назначения и ключевых элементов} | Should |

### 5.2 User Flows

**Flow 1: {Название}**

```
[Начало] → [Шаг 1] → [Шаг 2] → [Решение?]
                                    ↓ Да
                              [Шаг 3] → [Конец]
                                    ↓ Нет
                              [Альтернатива]
```

### 5.3 Требования к доступности

- [ ] Поддержка клавиатурной навигации
- [ ] Контрастность текста ≥ 4.5:1
- [ ] Alt-тексты для изображений
- [ ] Поддержка screen readers

---

## 6. Нефункциональные требования

### 6.1 Производительность

| ID | Метрика | Требование | Измерение |
|----|---------|------------|-----------|
| NF-001 | Время отклика API | < 200ms (p95) | Prometheus metrics |
| NF-002 | Время загрузки страницы | < 3s | Lighthouse |
| NF-003 | Throughput | > 100 RPS | Load testing |

### 6.2 Масштабируемость

| ID | Требование | Описание |
|----|------------|----------|
| NF-010 | Горизонтальное масштабирование | {Описание} |
| NF-011 | Ожидаемая нагрузка | {X пользователей, Y запросов} |

### 6.3 Безопасность

| ID | Требование | Описание |
|----|------------|----------|
| NF-020 | Аутентификация | {JWT/OAuth2/etc} |
| NF-021 | Авторизация | {RBAC/ABAC/etc} |
| NF-022 | Шифрование | {TLS 1.3, данные at rest} |
| NF-023 | Логирование | {Аудит действий} |

### 6.4 Надёжность

| ID | Метрика | Требование |
|----|---------|------------|
| NF-030 | Uptime | ≥ 99.9% |
| NF-031 | RTO | < 1 час |
| NF-032 | RPO | < 15 минут |

---

## 7. Технические ограничения

### 7.1 Обязательные технологии

- **Backend**: Python 3.11+, FastAPI
- **Database**: PostgreSQL 15+
- **Cache**: Redis 7+
- **Container**: Docker, Docker Compose
- **CI/CD**: GitHub Actions

### 7.2 Интеграции

| Система | Тип интеграции | Описание |
|---------|---------------|----------|
| {Система 1} | REST API | {Описание} |
| {Система 2} | Webhook | {Описание} |

### 7.3 Ограничения

- {Ограничение 1: описание и причина}
- {Ограничение 2: описание и причина}

---

## 8. Допущения и риски

### 8.1 Допущения

| # | Допущение | Влияние если неверно |
|---|-----------|---------------------|
| 1 | {Допущение} | {Последствия} |
| 2 | {Допущение} | {Последствия} |

### 8.2 Риски

| # | Риск | Вероятность | Влияние | Митигация |
|---|------|-------------|---------|-----------|
| 1 | {Риск} | High/Med/Low | High/Med/Low | {Как снизить} |
| 2 | {Риск} | High/Med/Low | High/Med/Low | {Как снизить} |

---

## 9. Открытые вопросы

| # | Вопрос | Статус | Ответственный | Решение |
|---|--------|--------|--------------|---------|
| 1 | {Вопрос} | Open | {Имя} | — |
| 2 | {Вопрос} | Resolved | {Имя} | {Решение} |

---

## 10. Глоссарий

| Термин | Определение |
|--------|-------------|
| {Термин 1} | {Определение} |
| {Термин 2} | {Определение} |

---

## 11. История изменений

| Версия | Дата | Автор | Изменения |
|--------|------|-------|-----------|
| 1.0 | {YYYY-MM-DD} | AI Analyst | Первоначальная версия |

---

## Качественные ворота

### PRD_READY Checklist

- [ ] Все секции заполнены
- [ ] Требования имеют уникальные ID (FR-*, NF-*, UI-*, INT-*)
- [ ] Критерии приёмки определены для каждого требования
- [ ] User stories связаны с требованиями
- [ ] Бизнес-пайплайн описан (основной flow, состояния сущностей)
- [ ] Data Pipeline описан (диаграмма потоков, трансформации данных)
- [ ] Интеграционный пайплайн описан (карта сервисов, точки интеграции, контракты)
- [ ] Раздел "Влияние на существующие пайплайны" заполнен
- [ ] Нет блокирующих открытых вопросов
- [ ] Риски идентифицированы и имеют план митигации
- [ ] Документ согласован с заинтересованными сторонами
