# Upstream конфигурация для {project_name} MVP
#
# Описание:
#   Определение backend-серверов для проксирования.
#   Включается в основной nginx.conf через include.
#
# Использование:
#   include /etc/nginx/conf.d/upstream.conf;

# === Business API ===
# Основной API сервис с бизнес-логикой
upstream api_backend {
    # Основной сервер
    server {context}_api:8000;

    # Keepalive соединения для производительности
    keepalive 32;

    # Балансировка (если несколько инстансов)
    # least_conn;  # Выбирать сервер с минимумом соединений
    # ip_hash;     # Привязка клиента к серверу по IP
}

# === Data API (PostgreSQL) ===
# Data-сервис для работы с PostgreSQL
upstream data_backend {
    server {context}_data:8001;
    keepalive 32;
}

# === Data API (MongoDB) ===
# Data-сервис для работы с MongoDB (если используется)
# upstream mongo_backend {
#     server {context}_mongo_data:8002;
#     keepalive 16;
# }

# === Background Worker Health ===
# Воркер для фоновых задач (только health check)
# upstream worker_backend {
#     server {context}_worker:8080;
#     keepalive 8;
# }

# === WebSocket (если нужен) ===
# Для real-time функциональности
# upstream ws_backend {
#     server {context}_api:8000;
#     keepalive 64;
# }

# === Параметры health check ===
# Примечание: активные health checks доступны только в Nginx Plus
# Для open-source версии используется passive health check:
#
# upstream api_backend {
#     server {context}_api:8000 max_fails=3 fail_timeout=30s;
# }
