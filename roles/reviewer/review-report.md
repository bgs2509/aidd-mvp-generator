# Функция: Создание Review Report

> **Назначение**: Формирование финального отчёта код-ревью.

---

## Цель

Создать структурированный отчёт о результатах код-ревью,
готовый для передачи на этап тестирования.

---

## Структура отчёта

```markdown
# Code Review Report: {Название проекта}

**Версия**: 1.0
**Дата**: {YYYY-MM-DD}
**Ревьюер**: AI Agent (Ревьюер)
**Статус**: PASSED / FAILED / PASSED_WITH_NOTES

---

## 1. Обзор

### 1.1 Scope ревью

| Сервис | Файлов | Строк кода |
|--------|--------|------------|
| {context}_api | {N} | {N} |
| {context}_data | {N} | {N} |
| {context}_bot | {N} | {N} |

### 1.2 Критерии оценки

- Архитектурные принципы
- Соответствие конвенциям
- Качество кода
- Покрытие тестами

---

## 2. Архитектура

### 2.1 HTTP-only доступ к данным

**Статус**: ✓ PASSED / ✗ FAILED

{Описание проверки и результатов}

### 2.2 DDD структура

**Статус**: ✓ PASSED / ✗ FAILED

{Описание проверки и результатов}

### 2.3 Разделение сервисов

**Статус**: ✓ PASSED / ✗ FAILED

{Описание проверки и результатов}

---

## 3. Конвенции

### 3.1 Именование

**Статус**: ✓ PASSED / ✗ FAILED

{Описание проверки и результатов}

### 3.2 Type Hints

**Статус**: ✓ PASSED / ✗ FAILED

{Описание проверки и результатов}

### 3.3 Docstrings

**Статус**: ✓ PASSED / ✗ FAILED

{Описание проверки и результатов}

---

## 4. Качество кода

### 4.1 DRY (Don't Repeat Yourself)

**Статус**: ✓ PASSED / ✗ FAILED

{Описание проверки и результатов}

### 4.2 KISS (Keep It Simple)

**Статус**: ✓ PASSED / ✗ FAILED

{Описание проверки и результатов}

### 4.3 YAGNI (You Aren't Gonna Need It)

**Статус**: ✓ PASSED / ✗ FAILED

{Описание проверки и результатов}

---

## 5. Автоматические проверки

| Инструмент | Команда | Результат | Ошибок |
|------------|---------|-----------|--------|
| Ruff Lint | `ruff check` | PASSED/FAILED | {N} |
| Ruff Format | `ruff format --check` | PASSED/FAILED | {N} |
| Mypy | `mypy` | PASSED/FAILED | {N} |

---

## 6. Найденные проблемы

### 6.1 Критические (Blocker)

| # | Файл | Строка | Проблема | Рекомендация |
|---|------|--------|----------|--------------|
| — | — | — | Нет критических проблем | — |

### 6.2 Важные (Major)

| # | Файл | Строка | Проблема | Рекомендация |
|---|------|--------|----------|--------------|
| 1 | {файл} | {строка} | {проблема} | {рекомендация} |

### 6.3 Незначительные (Minor)

| # | Файл | Строка | Проблема | Рекомендация |
|---|------|--------|----------|--------------|
| 1 | {файл} | {строка} | {проблема} | {рекомендация} |

---

## 7. Рекомендации

### 7.1 Обязательные изменения

1. {Изменение 1}
2. {Изменение 2}

### 7.2 Опциональные улучшения

1. {Улучшение 1}
2. {Улучшение 2}

---

## 8. Трассировка требований

| Req ID | Реализовано | Файл | Комментарий |
|--------|-------------|------|-------------|
| FR-001 | ✓ | api/v1/routes.py | — |
| FR-002 | ✓ | api/v1/routes.py | — |

---

## 9. Заключение

### Общий статус: {PASSED / FAILED / PASSED_WITH_NOTES}

### Резюме

{Краткое резюме результатов ревью}

### Качественные ворота

- [ ] Архитектурные принципы соблюдены
- [ ] Конвенции соблюдены
- [ ] Нет критических проблем
- [ ] Нет важных проблем (или они задокументированы)
- [ ] Автоматические проверки проходят

---

## 10. Следующие шаги

1. {Исправить найденные проблемы}
2. {Повторный ревью (если FAILED)}
3. {Перейти к тестированию (если PASSED)}
```

---

## Правила формирования отчёта

### 1. Статус ревью

```
PASSED:
- Нет критических проблем
- Нет важных проблем
- Все автоматические проверки проходят

PASSED_WITH_NOTES:
- Нет критических проблем
- Есть важные или незначительные проблемы
- Не блокируют переход к тестированию

FAILED:
- Есть критические проблемы
- Требуется исправление и повторный ревью
```

### 2. Классификация проблем

```
Blocker (Критические):
- Нарушение HTTP-only
- Прямой доступ к БД из business сервиса
- Event loop проблемы
- Security уязвимости

Major (Важные):
- Нарушение DDD структуры
- Отсутствие type hints
- Голый except
- Дублирование кода

Minor (Незначительные):
- Нарушение именования
- Отсутствие docstring
- Форматирование
- Стилистические проблемы
```

### 3. Рекомендации

```
Обязательные:
- Критические и важные проблемы
- Должны быть исправлены до перехода на следующий этап

Опциональные:
- Незначительные проблемы
- Улучшения качества
- Не блокируют прогресс
```

---

## Путь сохранения

```
ai-docs/docs/reports/review-report.md

Или с датой:
ai-docs/docs/reports/{YYYY-MM-DD}-review-report.md
```

---

## Качественные ворота: REVIEW_OK

### Критерии прохождения

- [ ] Статус ревью: PASSED или PASSED_WITH_NOTES
- [ ] Нет критических проблем (Blocker)
- [ ] Важные проблемы (Major) задокументированы
- [ ] Автоматические проверки проходят
- [ ] RTM обновлена (столбец Review)

---

## Источники

| Документ | Описание |
|----------|----------|
| `roles/reviewer/architecture-compliance.md` | Проверка архитектуры |
| `roles/reviewer/convention-compliance.md` | Проверка конвенций |
| `docs/reports/review-template.md` | Шаблон отчёта |
