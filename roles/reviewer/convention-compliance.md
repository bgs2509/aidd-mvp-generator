# Функция: Проверка конвенций

> **Назначение**: Верификация соответствия кода конвенциям проекта.

---

## Цель

Проверить, что код соответствует соглашениям о коде,
определённым в `conventions.md`.

---

## Проверяемые конвенции

### 1. Именование

#### Python код

| Элемент | Стиль | Пример |
|---------|-------|--------|
| Пакет | snake_case | `booking_api` |
| Модуль | snake_case | `user_service.py` |
| Класс | PascalCase | `UserService` |
| Функция | snake_case | `create_user` |
| Переменная | snake_case | `user_id` |
| Константа | UPPER_SNAKE | `MAX_RETRIES` |

**Команды проверки:**

```bash
# Проверка имён классов (должны быть PascalCase)
Grep: "^class [a-z]" in services/
# Если найдено — нарушение

# Проверка имён функций (должны быть snake_case)
Grep: "def [A-Z]" in services/
# Если найдено — нарушение

# Проверка констант (должны быть UPPER_SNAKE)
Grep: "^[A-Z][a-z].*=" in services/*/src/*/core/
# Может быть нарушением (нужна ручная проверка)
```

#### API и база данных

| Элемент | Стиль | Пример |
|---------|-------|--------|
| API путь | kebab-case | `/api/v1/user-profiles` |
| Query параметр | snake_case | `?user_id=123` |
| JSON поле | snake_case | `{"user_name": "..."}` |
| Таблица БД | snake_case, мн.ч. | `users` |
| Колонка БД | snake_case | `created_at` |

**Команды проверки:**

```bash
# Проверка API путей
Grep: '@router\.(get|post|put|delete)\("[^"]*[A-Z]' in services/
# CamelCase в путях — нарушение

# Проверка таблиц
Grep: '__tablename__.*[A-Z]' in services/
# CamelCase в таблицах — нарушение
```

### 2. Type Hints

```
ПРАВИЛО: Все функции должны иметь type hints.

Проверить:
- Все параметры функций типизированы
- Возвращаемые значения типизированы
- Используются современные типы (list вместо List)
```

**Команды проверки:**

```bash
# Проверка отсутствия типов
Grep: "def.*\):" in services/
# Функции без -> return type

# Проверка устаревших типов
Grep: "from typing import List" in services/
Grep: "from typing import Dict" in services/
# Должны использоваться list, dict (Python 3.9+)
```

### 3. Docstrings

```
ПРАВИЛО: Все публичные функции и классы имеют docstrings.
ФОРМАТ: Google стиль, на русском языке.

Проверить:
- Все классы имеют docstrings
- Все публичные методы имеют docstrings
- Docstrings на русском языке
```

**Пример правильного docstring:**

```python
def create_user(name: str, email: str) -> User:
    """
    Создать нового пользователя.

    Args:
        name: Имя пользователя.
        email: Email адрес.

    Returns:
        Созданный объект пользователя.

    Raises:
        ValidationError: Если данные невалидны.
    """
```

**Команды проверки:**

```bash
# Поиск классов без docstrings
Grep: "^class.*:\s*$" in services/
# Класс без docstring на следующей строке — нарушение

# Поиск функций без docstrings
Grep: "def.*:\s*$" in services/
# Функция без docstring — нарушение (для публичных)
```

### 4. Импорты

```
ПРАВИЛО: Импорты организованы и сгруппированы.

Порядок:
1. Стандартная библиотека
2. Сторонние библиотеки
3. Локальные импорты

Разделение:
- Пустая строка между группами
- Абсолютные импорты
```

**Пример правильных импортов:**

```python
# Стандартная библиотека
import asyncio
from datetime import datetime
from uuid import UUID

# Сторонние библиотеки
from fastapi import APIRouter, Depends
from pydantic import BaseModel

# Локальные импорты
from booking_api.core.config import settings
from booking_api.application.services.user_service import UserService
```

### 5. Обработка ошибок

```
ПРАВИЛО: Используются кастомные исключения.

Проверить:
- Определены кастомные исключения в core/exceptions.py
- Не используется голый except
- Исключения информативны
```

**Команды проверки:**

```bash
# Поиск голого except
Grep: "except:" in services/
# Голый except — нарушение

# Поиск кастомных исключений
Grep: "class.*Error.*Exception" in services/*/src/*/core/
# Должны быть определены
```

---

## Чек-лист проверки

### Именование

- [ ] Классы в PascalCase
- [ ] Функции в snake_case
- [ ] Переменные в snake_case
- [ ] Константы в UPPER_SNAKE_CASE
- [ ] API пути в kebab-case
- [ ] Таблицы БД в snake_case, множественное число

### Type Hints

- [ ] Все функции типизированы
- [ ] Используются современные типы
- [ ] Возвращаемые типы указаны

### Docstrings

- [ ] Все классы имеют docstrings
- [ ] Все публичные функции имеют docstrings
- [ ] Docstrings на русском языке
- [ ] Используется Google стиль

### Импорты

- [ ] Импорты сгруппированы
- [ ] Пустые строки между группами
- [ ] Абсолютные импорты

### Ошибки

- [ ] Кастомные исключения определены
- [ ] Нет голого except
- [ ] Исключения информативны

---

## Автоматические инструменты

### Ruff (линтер)

```bash
# Запуск проверки
ruff check services/

# Автоисправление
ruff check --fix services/
```

### Ruff (форматирование)

```bash
# Проверка форматирования
ruff format --check services/

# Автоформатирование
ruff format services/
```

### Mypy (типы)

```bash
# Проверка типов
mypy services/
```

---

## Результат проверки

```markdown
## Проверка конвенций

### Статус: PASSED / FAILED

### Автоматические проверки

| Инструмент | Статус | Ошибок |
|------------|--------|--------|
| ruff check | ✓/✗ | {N} |
| ruff format | ✓/✗ | {N} |
| mypy | ✓/✗ | {N} |

### Ручные проверки

| Категория | Статус | Комментарий |
|-----------|--------|-------------|
| Именование | ✓/✗ | {Комментарий} |
| Type Hints | ✓/✗ | {Комментарий} |
| Docstrings | ✓/✗ | {Комментарий} |
| Импорты | ✓/✗ | {Комментарий} |
| Ошибки | ✓/✗ | {Комментарий} |

### Найденные нарушения

| # | Файл | Строка | Нарушение | Рекомендация |
|---|------|--------|-----------|--------------|
| 1 | {файл} | {строка} | {описание} | {как исправить} |
```

---

## Источники

| Документ | Описание |
|----------|----------|
| `conventions.md` | Соглашения о коде |
| `knowledge/architecture/naming/` | Правила именования |
