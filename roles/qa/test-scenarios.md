# Функция: Создание тестовых сценариев

> **Назначение**: Формирование тестовых сценариев на основе требований.

---

## Цель

Создать тестовые сценарии, которые покрывают все функциональные
и нефункциональные требования из PRD.

---

## Входные данные

| Артефакт | Путь | Описание |
|----------|------|----------|
| PRD | `ai-docs/docs/prd/{name}-prd.md` | Требования |
| RTM | `ai-docs/docs/rtm.md` | Матрица трассировки |
| Код | `services/` | Реализованные сервисы |
| Ворота | REVIEW_OK | Должны быть пройдены |

---

## Типы тестовых сценариев

### 1. Функциональные тесты (FR)

```
Покрывают функциональные требования:
- CRUD операции
- Бизнес-логика
- Валидация данных
- Обработка ошибок
```

### 2. UI/UX тесты (UI) — для ботов

```
Покрывают UI требования:
- Команды бота
- Клавиатуры
- Сообщения
- Навигация
```

### 3. Нефункциональные тесты (NF)

```
Покрывают NFR:
- Производительность (время отклика)
- Доступность
- Безопасность
- Покрытие тестами
```

---

## Шаблон тестового сценария

```markdown
## TS-{NNN}: {Название сценария}

**Требование**: {FR-XXX / UI-XXX / NF-XXX}
**Приоритет**: High / Medium / Low
**Тип**: Unit / Integration / E2E

### Предусловия
- {Предусловие 1}
- {Предусловие 2}

### Шаги

| # | Действие | Ожидаемый результат |
|---|----------|---------------------|
| 1 | {Действие} | {Результат} |
| 2 | {Действие} | {Результат} |

### Тестовые данные
```json
{
  "input": {...},
  "expected_output": {...}
}
```

### Критерий успеха
{Как определить, что тест прошёл}
```

---

## Примеры сценариев

### Функциональный тест

```markdown
## TS-001: Создание ресторана

**Требование**: FR-001 (Создание ресторана)
**Приоритет**: High
**Тип**: Integration

### Предусловия
- Business API запущен
- Data API запущен
- База данных доступна

### Шаги

| # | Действие | Ожидаемый результат |
|---|----------|---------------------|
| 1 | POST /api/v1/restaurants с валидными данными | HTTP 201 Created |
| 2 | Проверить тело ответа | Содержит id, name, address |
| 3 | GET /api/v1/restaurants/{id} | HTTP 200, данные совпадают |

### Тестовые данные
```json
{
  "input": {
    "name": "Test Restaurant",
    "address": "123 Main St",
    "capacity": 50
  },
  "expected_output": {
    "id": "uuid",
    "name": "Test Restaurant",
    "address": "123 Main St",
    "capacity": 50,
    "created_at": "datetime"
  }
}
```

### Критерий успеха
Ресторан создан и может быть получен по ID
```

### Негативный тест

```markdown
## TS-002: Создание ресторана с невалидными данными

**Требование**: FR-001 (Создание ресторана)
**Приоритет**: High
**Тип**: Integration

### Предусловия
- Business API запущен

### Шаги

| # | Действие | Ожидаемый результат |
|---|----------|---------------------|
| 1 | POST /api/v1/restaurants без name | HTTP 422 Validation Error |
| 2 | Проверить тело ошибки | Содержит поле "name" |

### Тестовые данные
```json
{
  "input": {
    "address": "123 Main St"
  },
  "expected_output": {
    "error": {
      "code": "VALIDATION_ERROR",
      "details": [{"field": "name", "message": "Field required"}]
    }
  }
}
```

### Критерий успеха
Возвращается ошибка валидации с описанием проблемы
```

### Тест производительности

```markdown
## TS-010: Время отклика API

**Требование**: NF-001 (Время отклика <500ms)
**Приоритет**: High
**Тип**: Performance

### Предусловия
- Все сервисы запущены
- База данных содержит 1000 записей

### Шаги

| # | Действие | Ожидаемый результат |
|---|----------|---------------------|
| 1 | GET /api/v1/restaurants (100 запросов) | Среднее время <500ms |
| 2 | POST /api/v1/restaurants (50 запросов) | Среднее время <500ms |

### Метрики
- p50: <200ms
- p95: <500ms
- p99: <1000ms

### Критерий успеха
95% запросов выполняются менее чем за 500ms
```

---

## Матрица покрытия

```markdown
## Матрица покрытия требований тестами

| Req ID | Описание | Тестовые сценарии | Статус |
|--------|----------|-------------------|--------|
| FR-001 | Создание ресторана | TS-001, TS-002 | Покрыто |
| FR-002 | Список ресторанов | TS-003 | Покрыто |
| FR-003 | Поиск ресторана | TS-004, TS-005 | Покрыто |
| NF-001 | Время отклика | TS-010 | Покрыто |
| NF-003 | Coverage ≥75% | TS-020 | Покрыто |

### Статистика

- Всего требований: {N}
- Покрыто тестами: {N}
- Покрытие: {N}%
```

---

## Процесс создания сценариев

### Шаг 1: Анализ PRD

```
1. Прочитать все FR, UI, NF требования
2. Для каждого требования определить:
   - Позитивные сценарии (happy path)
   - Негативные сценарии (error cases)
   - Граничные случаи (edge cases)
```

### Шаг 2: Определение приоритетов

```
High:
- Must требования
- Критическая бизнес-логика
- Безопасность

Medium:
- Should требования
- Вторичная функциональность

Low:
- Could требования
- UI/UX детали
```

### Шаг 3: Определение типа теста

```
Unit:
- Отдельные функции
- Бизнес-логика в isolation
- Моки для зависимостей

Integration:
- API эндпоинты
- Взаимодействие сервисов
- База данных

E2E (для Level 3+):
- Полный user flow
- Все сервисы вместе
```

---

## Результат

```markdown
# Тестовые сценарии: {Название проекта}

**Версия**: 1.0
**Дата**: {YYYY-MM-DD}
**Автор**: AI Agent (QA)

---

## Обзор

| Метрика | Значение |
|---------|----------|
| Всего требований | {N} |
| Тестовых сценариев | {N} |
| Покрытие требований | {N}% |

---

## Сценарии по категориям

### Функциональные (FR)
- TS-001: ...
- TS-002: ...

### UI/UX (UI)
- TS-050: ...

### Нефункциональные (NF)
- TS-100: ...

---

## Матрица покрытия

{Таблица покрытия}
```

---

## Путь сохранения

```
ai-docs/docs/test-scenarios.md
```

---

## Источники

| Документ | Описание |
|----------|----------|
| `templates/documents/prd-template.md` | Шаблон PRD |
| `templates/documents/rtm-template.md` | Шаблон RTM |
