# Функция: Выявление ограничений

> **Назначение**: Определение технических и архитектурных ограничений.

---

## Цель

Выявить ограничения, которые нужно учесть при проектировании
и реализации новой функциональности.

---

## Типы ограничений

### Технические ограничения

| Категория | Что проверять |
|-----------|---------------|
| Python версия | `python --version`, pyproject.toml |
| Зависимости | requirements.txt, совместимость |
| Async/Sync | Стиль кода (async everywhere?) |
| Event Loop | Владение event loop |

### Архитектурные ограничения

| Категория | Что проверять |
|-----------|---------------|
| HTTP-only | Можно ли добавить прямой доступ к БД? (Нет!) |
| Сервисы | Сколько сервисов? Как общаются? |
| API версии | Есть ли v1, v2? Нужна ли новая версия? |

### Инфраструктурные ограничения

| Категория | Что проверять |
|-----------|---------------|
| Docker | Используется ли Docker? |
| Порты | Какие порты заняты? |
| БД | PostgreSQL? MongoDB? Обе? |
| Redis | Используется ли? Для чего? |

---

## Процесс выявления

### 1. Python и зависимости

```bash
# Версия Python
Read: pyproject.toml (python_requires)
Read: Dockerfile (FROM python:X.X)

# Зависимости
Read: requirements.txt
Read: requirements-dev.txt
```

**Вопросы**:
- Совместима ли новая функция с текущими зависимостями?
- Нужны ли новые библиотеки?
- Нет ли конфликтов версий?

### 2. Async vs Sync

```bash
Grep: "async def"
Grep: "await "
Grep: "asyncio"
```

**Правило**: Если проект async — новый код тоже должен быть async.

### 3. Event Loop

```bash
Grep: "asyncio.run"
Grep: "get_event_loop"
Grep: "FastAPI"
Grep: "Dispatcher"
```

**Правило**: Каждый сервис владеет ОДНИМ event loop.

### 4. Доступ к данным

```bash
# Проверить HTTP-only
Grep: "from sqlalchemy" (в бизнес-слое — ПЛОХО)
Grep: "httpx" (в бизнес-слое — ХОРОШО)
Grep: "DataApiClient"
```

**Правило**: Бизнес-сервисы НЕ обращаются к БД напрямую.

### 5. Инфраструктура

```bash
Read: docker-compose.yml
Read: docker-compose.dev.yml
```

**Вопросы**:
- Какие сервисы запущены?
- Какие порты заняты?
- Какие volumes используются?

---

## Результат анализа

```markdown
## Технические ограничения

| Ограничение | Значение | Влияние на фичу |
|-------------|----------|-----------------|
| Python | 3.11+ | Можно использовать новый синтаксис |
| Async | Да | Весь новый код async |
| FastAPI | 0.100+ | Использовать Annotated DI |

## Архитектурные ограничения

| Ограничение | Описание |
|-------------|----------|
| HTTP-only | Новая функция должна использовать HTTP клиент |
| DDD | Соблюдать слоистую структуру |

## Инфраструктурные ограничения

| Ресурс | Статус |
|--------|--------|
| Порт 8000 | Занят (business-api) |
| Порт 8001 | Занят (data-api) |
| Порт 8002 | Свободен |

## Рекомендации

1. {Рекомендация по интеграции}
2. {Потенциальный риск}
```

---

## Источники

| Документ | Описание |
|----------|----------|
| `.ai-framework/docs/reference/tech_stack.md` | Технологический стек |
| `.ai-framework/docs/atomic/architecture/event-loop-management.md` | Event Loop |
