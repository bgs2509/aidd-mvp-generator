# Функция: Анализ кодовой базы

> **Назначение**: Изучение существующего кода для режима FEATURE.

---

## Цель

Понять структуру и паттерны существующего проекта для корректной
интеграции новой функциональности.

---

## Когда применяется

```
if MODE == FEATURE:
    → Выполнить полный анализ кода
else:  # MODE == CREATE
    → Пропустить (нет существующего кода)
```

---

## Шаги анализа

### 1. Структура проекта

```bash
# Определить структуру
Glob: **/*.py
Glob: **/*.md
Glob: **/Dockerfile

# Понять организацию
ls -la src/ services/
```

**Что искать**:
- DDD структура (api/application/domain/infrastructure)
- Монолит или микросервисы
- Разделение по сервисам

### 2. Сервисы и компоненты

```bash
# Найти сервисы
Grep: "class.*Service"
Grep: "class.*Repository"
Grep: "class.*Client"
```

**Что определить**:
- Какие сервисы существуют
- Как организована бизнес-логика
- Какие внешние клиенты используются

### 3. API эндпоинты

```bash
# Найти роуты
Grep: "@router"
Grep: "@app.get"
Grep: "@app.post"
```

**Что определить**:
- Существующие эндпоинты
- Версионирование API (v1, v2)
- Паттерны роутинга

### 4. Модели данных

```bash
# Найти модели
Grep: "class.*BaseModel"
Grep: "class.*Base"
Grep: "Column("
```

**Что определить**:
- Структура данных
- Связи между моделями
- Используемые типы

### 5. Зависимости

```bash
# Проверить зависимости
Read: requirements.txt
Read: pyproject.toml
```

**Что определить**:
- Используемые библиотеки
- Версии
- Совместимость

---

## Результат анализа

```markdown
## Структура проекта

Тип: {DDD/Hexagonal | Monolith | Microservices}
Сервисы: {Список сервисов}

## Компоненты

| Компонент | Тип | Файл |
|-----------|-----|------|
| UserService | Application Service | user_service.py |
| OrderRepository | Repository | order_repository.py |

## API

| Метод | Путь | Описание |
|-------|------|----------|
| GET | /api/v1/users | Список пользователей |

## Модели данных

| Модель | Поля |
|--------|------|
| User | id, name, email |

## Зависимости

| Библиотека | Версия |
|------------|--------|
| FastAPI | 0.100+ |
| SQLAlchemy | 2.0+ |
```

---

## Источники

| Документ | Описание |
|----------|----------|
| `.ai-framework/docs/reference/project-structure.md` | Структура проекта |
| `.ai-framework/ARCHITECTURE.md` | Архитектура |
