# Найденные проблемы фреймворка AIDD-MVP Generator

> **Дата**: 2025-12-22
> **Контекст**: Выполнение команды `/idea` для проекта `fastapi-crud-aidd-generated`
> **Версия фреймворка**: Текущая (git submodule)

---

## Issue #1: AI не проверяет существование директорий перед созданием

### Описание

**Файл**: `.aidd/.claude/commands/idea.md`

При выполнении команды `/idea` AI-агент сразу пытается создать структуру директорий `ai-docs/docs/{prd,architecture,plans,reports,research}` без предварительной проверки, существуют ли они уже.

### Проблема

1. **Отсутствует явная инструкция** в `idea.md` о необходимости проверки существования директорий
2. **Принцип VERIFY BEFORE ACT** из `CLAUDE.md` не применяется к созданию директорий
3. AI тратит лишнее действие на создание уже существующих директорий

### Текущее поведение

```bash
# AI сразу выполняет:
mkdir -p ai-docs/docs/{prd,architecture,plans,reports,research}

# Без предварительной проверки:
ls -la ai-docs/docs/ 2>/dev/null
```

### Ожидаемое поведение

```python
def create_directory_structure():
    """
    Создание структуры директорий с предварительной проверкой.
    """
    target_dirs = [
        "ai-docs/docs/prd",
        "ai-docs/docs/architecture",
        "ai-docs/docs/plans",
        "ai-docs/docs/reports",
        "ai-docs/docs/research"
    ]

    # 1. VERIFY: Проверить что уже существует
    existing = [d for d in target_dirs if Path(d).exists()]
    missing = [d for d in target_dirs if not Path(d).exists()]

    if existing:
        print(f"✓ Директории уже существуют: {existing}")

    # 2. ACT: Создать только недостающие
    if missing:
        for d in missing:
            Path(d).mkdir(parents=True, exist_ok=True)
        print(f"✓ Созданы директории: {missing}")
    else:
        print("✓ Все директории уже на месте")
```

### Затронутые файлы

| Файл | Проблема |
|------|----------|
| `.aidd/.claude/commands/idea.md` | Нет инструкции проверять существование |
| `.aidd/workflow.md` | Bootstrap-раздел не акцентирует VERIFY BEFORE ACT |

### Рекомендация

1. Добавить в `idea.md` явный шаг проверки существования структуры
2. Добавить в `workflow.md` (раздел Bootstrap) напоминание о принципе VERIFY BEFORE ACT
3. Обновить псевдокод `auto_bootstrap()` с проверкой существования

### Пример исправления для idea.md

```markdown
## Bootstrap: Проверка и инициализация

### Алгоритм создания структуры

1. **VERIFY** — Проверить существующую структуру:
   ```bash
   ls -la ai-docs/docs/ 2>/dev/null || echo "Не существует"
   ```

2. **ACT** — Создать только недостающие директории:
   ```bash
   # Создавать только если не существует
   [ -d "ai-docs/docs/prd" ] || mkdir -p ai-docs/docs/prd
   ```
```

### Приоритет

**Средний** — не блокирует работу, но нарушает принцип VERIFY BEFORE ACT, описанный в CLAUDE.md.

---

## Issue #2: Несогласованность между CLAUDE.md и практикой AI

### Описание

В `CLAUDE.md` чётко указан принцип:

```
┌─────────────────────────────────────────────────────────────────┐
│  ПЕРЕД ЛЮБЫМ ДЕЙСТВИЕМ AI ОБЯЗАН:                               │
├─────────────────────────────────────────────────────────────────┤
│  1. СОЗДАНИЕ ФАЙЛА  → Проверить, что файл НЕ существует         │
│  ...                                                            │
└─────────────────────────────────────────────────────────────────┘
```

Однако этот принцип:
- Не дублируется в конкретных командах (`idea.md`, `init.md`)
- Не включает явно создание директорий
- AI может пропустить эту проверку, читая только инструкции команды

### Рекомендация

Добавить в каждую команду напоминание:

```markdown
> ⚠️ **VERIFY BEFORE ACT**: Перед созданием файлов/директорий
> проверьте их существование (см. CLAUDE.md)
```

### Приоритет

**Низкий** — косметическое улучшение документации.

---

## Резюме

| # | Issue | Файл | Приоритет | Статус |
|---|-------|------|-----------|--------|
| 1 | AI не проверяет существование директорий | `idea.md`, `workflow.md` | Средний | Открыт |
| 2 | Принцип VERIFY BEFORE ACT не дублируется в командах | `*.md` команды | Низкий | Открыт |

---

*Файл создан во время выполнения `/idea` для проекта fastapi-crud-aidd-generated*
