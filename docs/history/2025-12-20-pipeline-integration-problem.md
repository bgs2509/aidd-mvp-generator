# Проблема интеграции пайплайнов: AIDD-MVP vs .ai-framework

> **ARCHIVED**: Проблема решена. .ai-framework используется как read-only справочник.
> См. политику в [CLAUDE.md](../../CLAUDE.md) секция "Политика .ai-framework/"

**Версия**: 1.0
**Дата создания**: 2025-12-20
**Автор**: AI Agent (Исследователь)
**Статус**: ✅ РЕШЕНО (ARCHIVED)

---

## Оглавление

1. [Контекст проблемы](#1-контекст-проблемы)
2. [Обнаруженные фреймворки](#2-обнаруженные-фреймворки)
3. [Детальное сравнение](#3-детальное-сравнение)
4. [Пайплайны режимов CREATE и FEATURE](#4-пайплайны-режимов-create-и-feature)
5. [Пайплайны slash-команд](#5-пайплайны-slash-команд)
6. [Оценка совместимости](#6-оценка-совместимости)
7. [Детальное решение](#7-детальное-решение)
8. [План действий](#8-план-действий)

---

## 1. Контекст проблемы

### 1.1 Исходная ситуация

При анализе проекта `aidd-mvp-generator` было обнаружено отсутствие критических файлов:
- `INDEX.md` — индекс документации
- `.pipeline-state.json` — состояние пайплайна
- Navigation Matrix — матрица навигации по стадиям

### 1.2 Неожиданное открытие

При поиске этих файлов обнаружено, что они **существуют**, но находятся в отдельной директории `.ai-framework/`:

```
.ai-framework/
├── AGENTS.md                    ← Инструкции для AI (7-стадийный процесс)
├── CLAUDE.md                    ← Pre-Action Verification Protocol
├── docs/
│   ├── INDEX.md                 ← СУЩЕСТВУЕТ!
│   ├── guides/
│   │   └── ai-code-generation-master-workflow.md  ← Navigation Matrix
│   └── reference/
│       └── deliverables-catalog.md  ← Каталог артефактов
```

### 1.3 Суть проблемы

В проекте существуют **два параллельных фреймворка** с разными:
- Количеством стадий (7 vs 8)
- Набором артефактов
- Подходами к навигации
- Инструментами обнаружения файлов

**Результат**: AI-агент не знает какому фреймворку следовать.

---

## 2. Обнаруженные фреймворки

### 2.1 Фреймворк A: AIDD-MVP Generator (корень проекта)

| Параметр | Значение |
|----------|----------|
| **Расположение** | Корень проекта |
| **Основные файлы** | `CLAUDE.md`, `workflow.md`, `conventions.md` |
| **Количество стадий** | 8 этапов |
| **Команды** | 9 slash-команд в `.claude/commands/` |
| **Агенты** | 7 ролей в `.claude/agents/` |
| **Качественные ворота** | 8 gates |

### 2.2 Фреймворк B: .ai-framework (submodule)

| Параметр | Значение |
|----------|----------|
| **Расположение** | `.ai-framework/` |
| **Основные файлы** | `AGENTS.md`, `CLAUDE.md`, `docs/INDEX.md` |
| **Количество стадий** | 7 стадий |
| **Навигация** | Navigation Matrix |
| **Артефакты** | `deliverables-catalog.md` |
| **Maturity Levels** | 4 уровня (PoC → Production) |

---

## 3. Детальное сравнение

### 3.1 Сравнение стадий

```
AIDD-MVP Generator (8 этапов)     .ai-framework (7 стадий)
═══════════════════════════════   ════════════════════════════════
1. Идея (/idea)                   1. Initialization
   ├─ PRD формирование               ├─ Project Requirements
   └─ PRD_READY                      └─ Navigation Matrix setup

2. Исследование (/research)       2. Requirements Engineering
   ├─ Анализ кодовой базы            ├─ PRD формирование
   └─ RESEARCH_DONE                  └─ Stakeholder analysis

3. Архитектура (/plan)            3. Architecture Design
   ├─ План архитектуры               ├─ Maturity Level Selection
   └─ PLAN_APPROVED                  └─ Service Architecture

4. Реализация (/generate)         4. Implementation
   ├─ Генерация кода                 ├─ 4.1 Data API (PostgreSQL)
   └─ IMPLEMENT_OK                   ├─ 4.1b Data API (MongoDB)
                                     ├─ 4.2 Business API
5. Ревью (/review)                   ├─ 4.3 Telegram Bot
   ├─ Код-ревью                      ├─ 4.4 Background Worker
   └─ REVIEW_OK                      └─ 4.5 Integration

6. QA (/test)                     5. Quality Assurance
   ├─ Тестирование                   ├─ Testing
   └─ QA_PASSED                      └─ Code Review

7. Валидация (/validate)          6. Deployment Preparation
   ├─ Проверка артефактов            ├─ Infrastructure
   └─ ALL_GATES_PASSED               └─ CI/CD

8. Деплой (/deploy)               7. Validation & Launch
   ├─ Запуск приложения              ├─ Final Validation
   └─ DEPLOYED                       └─ Launch
```

### 3.2 Ключевые различия

| Аспект | AIDD-MVP | .ai-framework |
|--------|----------|---------------|
| **Навигация** | Статический порядок чтения | Dynamic Navigation Matrix |
| **Индекс** | Отсутствует | `docs/INDEX.md` |
| **Каталог артефактов** | Нет единого файла | `deliverables-catalog.md` |
| **Maturity Levels** | Только Level 2 (MVP) | 4 уровня (PoC → Production) |
| **Состояние** | Нет файла состояния | Предполагает `.pipeline-state.json` |
| **Ссылки** | Нет `LINKS_REFERENCE.md` | Ссылки через INDEX.md |

### 3.3 Что есть в .ai-framework, но нет в AIDD-MVP

1. **Navigation Matrix** — таблица "стадия → какие документы читать"
2. **INDEX.md** — полный индекс документации
3. **deliverables-catalog.md** — каталог всех артефактов с шаблонами
4. **Maturity Levels** — выбор уровня зрелости (PoC/MVP/Production)
5. **Stage-Gate навигация** — условные под-стадии (4.1, 4.1b, 4.1c...)

### 3.4 Что есть в AIDD-MVP, но нет в .ai-framework

1. **Slash-команды** — 9 интерактивных команд
2. **8 качественных ворот** — явные gates с критериями
3. **Режим FEATURE** — добавление функционала
4. **conventions.md** — соглашения о коде
5. **templates/** — готовые шаблоны сервисов

---

## 4. Пайплайны режимов CREATE и FEATURE

### 4.1 Пайплайн CREATE (новый проект)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         РЕЖИМ CREATE                                     │
│                    (Создание нового MVP)                                 │
└─────────────────────────────────────────────────────────────────────────┘

User Input: /idea "Создать сервис бронирования столиков"
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ ЭТАП 1: ИДЕЯ                                                             │
│ Агент: Аналитик                                                          │
│ Команда: /idea                                                           │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. CLAUDE.md                     ← Правила верификации                 │
│   2. conventions.md                ← Соглашения                          │
│   3. workflow.md                   ← Обзор процесса                      │
│   4. .claude/agents/analyst.md     ← Инструкции роли                     │
│   5. roles/analyst/*.md            ← Детальные функции                   │
│   6. knowledge/architecture/       ← База знаний                         │
│                                                                          │
│ Создаёт:                                                                 │
│   • docs/prd/{name}-prd.md         ← PRD документ                        │
│                                                                          │
│ Ворота: PRD_READY                                                        │
│   [ ] Все разделы PRD заполнены                                          │
│   [ ] FR и NF требования определены                                      │
│   [ ] Нет блокирующих вопросов                                           │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼ PRD_READY ✓
┌──────────────────────────────────────────────────────────────────────────┐
│ ЭТАП 2: ИССЛЕДОВАНИЕ                                                     │
│ Агент: Исследователь                                                     │
│ Команда: /research                                                       │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. .claude/agents/researcher.md  ← Инструкции роли                     │
│   2. roles/researcher/*.md         ← Детальные функции                   │
│   3. docs/prd/{name}-prd.md        ← Созданный PRD                       │
│   4. templates/                    ← Доступные шаблоны                   │
│                                                                          │
│ Анализирует:                                                             │
│   • Существующий код (если есть)                                         │
│   • Паттерны из templates/                                               │
│   • Технические ограничения                                              │
│                                                                          │
│ Ворота: RESEARCH_DONE                                                    │
│   [ ] Код проанализирован                                                │
│   [ ] Паттерны выявлены                                                  │
│   [ ] Ограничения задокументированы                                      │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼ RESEARCH_DONE ✓
┌──────────────────────────────────────────────────────────────────────────┐
│ ЭТАП 3: АРХИТЕКТУРА                                                      │
│ Агент: Архитектор                                                        │
│ Команда: /plan                                                           │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. .claude/agents/architect.md   ← Инструкции роли                     │
│   2. roles/architect/*.md          ← Детальные функции                   │
│   3. knowledge/architecture/       ← Архитектурные принципы              │
│   4. docs/prd/{name}-prd.md        ← PRD                                 │
│                                                                          │
│ Создаёт:                                                                 │
│   • docs/architecture/{name}-plan.md  ← План архитектуры                 │
│                                                                          │
│ Ворота: PLAN_APPROVED                                                    │
│   [ ] План содержит все компоненты                                       │
│   [ ] Типы сервисов определены                                           │
│   [ ] Пользователь утвердил план                                         │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼ PLAN_APPROVED ✓
┌──────────────────────────────────────────────────────────────────────────┐
│ ЭТАП 4: РЕАЛИЗАЦИЯ                                                       │
│ Агент: Реализатор                                                        │
│ Команда: /generate                                                       │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. .claude/agents/implementer.md ← Инструкции роли                     │
│   2. roles/implementer/*.md        ← Детальные функции                   │
│   3. templates/services/           ← Шаблоны сервисов                    │
│   4. templates/shared/             ← Общие компоненты                    │
│   5. templates/infrastructure/     ← Docker, Nginx, CI/CD                │
│   6. docs/architecture/{name}-plan.md ← План                             │
│                                                                          │
│ Создаёт:                                                                 │
│   • services/{name}_api/           ← Business API                        │
│   • services/{name}_data/          ← Data API                            │
│   • services/{name}_bot/           ← Telegram Bot (опционально)          │
│   • docker-compose.yml             ← Инфраструктура                      │
│   • Makefile                       ← Команды сборки                      │
│   • tests/                         ← Тесты                               │
│                                                                          │
│ Ворота: IMPLEMENT_OK                                                     │
│   [ ] Все сервисы созданы                                                │
│   [ ] Код соответствует conventions                                      │
│   [ ] Базовые тесты проходят                                             │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼ IMPLEMENT_OK ✓
┌──────────────────────────────────────────────────────────────────────────┐
│ ЭТАП 5: РЕВЬЮ                                                            │
│ Агент: Ревьюер                                                           │
│ Команда: /review                                                         │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. .claude/agents/reviewer.md    ← Инструкции роли                     │
│   2. roles/reviewer/*.md           ← Чеклисты ревью                      │
│   3. conventions.md                ← Соглашения для проверки             │
│   4. services/                     ← Созданный код                       │
│                                                                          │
│ Создаёт:                                                                 │
│   • docs/reports/review-report.md  ← Отчёт ревью                         │
│                                                                          │
│ Ворота: REVIEW_OK                                                        │
│   [ ] 0 blockers                                                         │
│   [ ] 0 critical issues                                                  │
│   [ ] Все замечания исправлены                                           │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼ REVIEW_OK ✓
┌──────────────────────────────────────────────────────────────────────────┐
│ ЭТАП 6: QA                                                               │
│ Агент: QA                                                                │
│ Команда: /test                                                           │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. .claude/agents/qa.md          ← Инструкции роли                     │
│   2. roles/qa/*.md                 ← Тестовые сценарии                   │
│   3. docs/prd/{name}-prd.md        ← Требования для теста                │
│   4. services/                     ← Код для тестирования                │
│   5. tests/                        ← Существующие тесты                  │
│                                                                          │
│ Выполняет:                                                               │
│   • pytest --cov                   ← Запуск тестов                       │
│   • Проверка покрытия                                                    │
│                                                                          │
│ Создаёт:                                                                 │
│   • docs/reports/qa-report.md      ← QA отчёт                            │
│                                                                          │
│ Ворота: QA_PASSED                                                        │
│   [ ] Coverage ≥ 75%                                                     │
│   [ ] Все тесты проходят                                                 │
│   [ ] Нет критических багов                                              │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼ QA_PASSED ✓
┌──────────────────────────────────────────────────────────────────────────┐
│ ЭТАП 7: ВАЛИДАЦИЯ                                                        │
│ Агент: Валидатор                                                         │
│ Команда: /validate                                                       │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. .claude/agents/validator.md   ← Инструкции роли                     │
│   2. roles/validator/*.md          ← Чеклисты валидации                  │
│   3. Все артефакты проекта         ← Полная проверка                     │
│                                                                          │
│ Проверяет:                                                               │
│   • Все 6 предыдущих ворот пройдены                                      │
│   • Все артефакты существуют                                             │
│   • RTM (Requirements Traceability Matrix)                               │
│                                                                          │
│ Создаёт:                                                                 │
│   • docs/reports/validation-report.md ← Отчёт валидации                  │
│   • docs/rtm.md                    ← Матрица трассировки                 │
│                                                                          │
│ Ворота: ALL_GATES_PASSED                                                 │
│   [ ] PRD_READY ✓                                                        │
│   [ ] RESEARCH_DONE ✓                                                    │
│   [ ] PLAN_APPROVED ✓                                                    │
│   [ ] IMPLEMENT_OK ✓                                                     │
│   [ ] REVIEW_OK ✓                                                        │
│   [ ] QA_PASSED ✓                                                        │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼ ALL_GATES_PASSED ✓
┌──────────────────────────────────────────────────────────────────────────┐
│ ЭТАП 8: ДЕПЛОЙ                                                           │
│ Агент: Валидатор                                                         │
│ Команда: /deploy                                                         │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. .claude/commands/deploy.md    ← Инструкции деплоя                   │
│   2. templates/infrastructure/     ← Конфиги инфраструктуры              │
│                                                                          │
│ Выполняет:                                                               │
│   • make build                     ← Сборка контейнеров                  │
│   • make up                        ← Запуск                              │
│   • make health                    ← Проверка health                     │
│                                                                          │
│ Ворота: DEPLOYED                                                         │
│   [ ] Контейнеры запущены                                                │
│   [ ] Health-check проходит                                              │
│   [ ] Базовые сценарии работают                                          │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼ DEPLOYED ✓
                        ┌─────────────┐
                        │   ГОТОВО!   │
                        │  MVP создан │
                        └─────────────┘
```

### 4.2 Пайплайн FEATURE (добавление фичи)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         РЕЖИМ FEATURE                                    │
│                  (Добавление функционала)                                │
└─────────────────────────────────────────────────────────────────────────┘

User Input: /idea "Добавить систему уведомлений по email"
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ ЭТАП 1: ИДЕЯ (адаптированный)                                            │
│ Агент: Аналитик                                                          │
│ Команда: /idea                                                           │
├──────────────────────────────────────────────────────────────────────────┤
│ ОТЛИЧИЕ от CREATE:                                                       │
│   • Анализирует СУЩЕСТВУЮЩИЙ код                                         │
│   • Определяет точки интеграции                                          │
│   • НЕ создаёт полный PRD                                                │
│                                                                          │
│ Читает дополнительно:                                                    │
│   • services/                      ← Существующий код                    │
│   • docs/prd/{existing}-prd.md     ← Существующий PRD                    │
│   • docs/architecture/{existing}-plan.md ← Существующий план             │
│                                                                          │
│ Создаёт:                                                                 │
│   • docs/prd/{feature}-requirements.md  ← Требования фичи                │
│                                                                          │
│ Ворота: FEATURE_REQUIREMENTS_READY                                       │
│   [ ] Фича описана                                                       │
│   [ ] Точки интеграции определены                                        │
│   [ ] Влияние на существующий код оценено                                │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ ЭТАП 2: ИССЛЕДОВАНИЕ (расширенный)                                       │
│ Агент: Исследователь                                                     │
│ Команда: /research                                                       │
├──────────────────────────────────────────────────────────────────────────┤
│ ОТЛИЧИЕ от CREATE:                                                       │
│   • Глубокий анализ существующего кода                                   │
│   • Поиск похожего функционала (DRY)                                     │
│   • Определение затронутых компонентов                                   │
│                                                                          │
│ Анализирует:                                                             │
│   • services/{name}_api/           ← Существующий API                    │
│   • services/{name}_data/          ← Существующие модели                 │
│   • tests/                         ← Существующие тесты                  │
│                                                                          │
│ Ворота: RESEARCH_DONE                                                    │
│   [ ] Существующий код понят                                             │
│   [ ] Конфликты не обнаружены                                            │
│   [ ] Точки расширения определены                                        │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ ЭТАП 3: АРХИТЕКТУРА ФИЧИ                                                 │
│ Агент: Архитектор                                                        │
│ Команда: /feature-plan                                                   │
├──────────────────────────────────────────────────────────────────────────┤
│ ОТЛИЧИЕ от CREATE:                                                       │
│   • Использует /feature-plan вместо /plan                                │
│   • План расширения, НЕ создания                                         │
│   • Учитывает существующую архитектуру                                   │
│                                                                          │
│ Создаёт:                                                                 │
│   • docs/plans/{feature}-plan.md   ← План реализации фичи                │
│                                                                          │
│ Ворота: FEATURE_PLAN_APPROVED                                            │
│   [ ] План не нарушает архитектуру                                       │
│   [ ] Backward compatibility сохранена                                   │
│   [ ] Пользователь утвердил план                                         │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ ЭТАП 4: РЕАЛИЗАЦИЯ (инкрементальная)                                     │
│ Агент: Реализатор                                                        │
│ Команда: /generate                                                       │
├──────────────────────────────────────────────────────────────────────────┤
│ ОТЛИЧИЕ от CREATE:                                                       │
│   • РЕДАКТИРУЕТ существующие файлы                                       │
│   • Добавляет НОВЫЕ файлы только при необходимости                       │
│   • Обязательно читает перед редактированием                             │
│                                                                          │
│ Модифицирует:                                                            │
│   • services/{name}_api/routers/   ← Новые эндпоинты                     │
│   • services/{name}_data/models/   ← Новые модели (если нужны)           │
│   • services/{name}_api/services/  ← Новая бизнес-логика                 │
│                                                                          │
│ Добавляет:                                                               │
│   • tests/test_{feature}.py        ← Тесты новой функциональности        │
│                                                                          │
│ Ворота: IMPLEMENT_OK                                                     │
│   [ ] Фича реализована                                                   │
│   [ ] Существующий код не сломан                                         │
│   [ ] Новые тесты проходят                                               │
│   [ ] Старые тесты проходят                                              │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ ЭТАПЫ 5-8: Аналогичны CREATE                                             │
│ /review → /test → /validate → /deploy                                    │
│                                                                          │
│ ОСОБЕННОСТИ:                                                             │
│   • Review проверяет совместимость с существующим кодом                  │
│   • QA запускает ВСЕ тесты (регрессия)                                   │
│   • Validate обновляет RTM                                               │
│   • Deploy — hot reload без даунтайма                                    │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## 5. Пайплайны slash-команд

### 5.1 Команда /idea

```
┌──────────────────────────────────────────────────────────────────────────┐
│                           КОМАНДА /idea                                  │
│                        Агент: Аналитик                                   │
└──────────────────────────────────────────────────────────────────────────┘

ВХОД: /idea "описание проекта или фичи"
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 1. ОПРЕДЕЛЕНИЕ РЕЖИМА                                                    │
├──────────────────────────────────────────────────────────────────────────┤
│ Проверяет:                                                               │
│   • Существует ли services/ ?                                            │
│   • Существует ли docs/prd/*.md ?                                        │
│                                                                          │
│ Если да → FEATURE режим                                                  │
│ Если нет → CREATE режим                                                  │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 2. ЗАГРУЗКА ДОКУМЕНТАЦИИ                                                 │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает в порядке:                                                        │
│   1. CLAUDE.md                                                           │
│   2. conventions.md                                                      │
│   3. workflow.md                                                         │
│   4. .claude/agents/analyst.md                                           │
│   5. .claude/commands/idea.md                                            │
│   6. roles/analyst/initialization.md                                     │
│   7. roles/analyst/prompt-validation.md                                  │
│   8. roles/analyst/requirements-gathering.md                             │
│   9. roles/analyst/prd-formation.md                                      │
│  10. knowledge/architecture/ddd-hexagonal.md                             │
│  11. docs/templates/prd-template.md                                      │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 3. ВАЛИДАЦИЯ ПРОМПТА                                                     │
├──────────────────────────────────────────────────────────────────────────┤
│ Проверяет:                                                               │
│   • Промпт содержит достаточно информации?                               │
│   • Цель проекта понятна?                                                │
│   • Есть ли неоднозначности?                                             │
│                                                                          │
│ Если нет → Задаёт уточняющие вопросы                                     │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 4. СБОР ТРЕБОВАНИЙ                                                       │
├──────────────────────────────────────────────────────────────────────────┤
│ Определяет:                                                              │
│   • Функциональные требования (FR)                                       │
│   • Нефункциональные требования (NF)                                     │
│   • Ограничения                                                          │
│   • Предположения                                                        │
│   • Стейкхолдеры                                                         │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 5. ФОРМИРОВАНИЕ PRD                                                      │
├──────────────────────────────────────────────────────────────────────────┤
│ Создаёт: docs/prd/{name}-prd.md                                          │
│                                                                          │
│ Структура:                                                               │
│   1. Обзор проекта                                                       │
│   2. Цели и задачи                                                       │
│   3. Стейкхолдеры                                                        │
│   4. Функциональные требования                                           │
│   5. Нефункциональные требования                                         │
│   6. Ограничения                                                         │
│   7. Риски                                                               │
│   8. Критерии успеха                                                     │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 6. ПРОВЕРКА ВОРОТ PRD_READY                                              │
├──────────────────────────────────────────────────────────────────────────┤
│ Чек-лист:                                                                │
│   [ ] Все разделы PRD заполнены                                          │
│   [ ] FR и NF требования определены                                      │
│   [ ] Нет блокирующих вопросов                                           │
│   [ ] Риски идентифицированы                                             │
│   [ ] Критерии успеха измеримы                                           │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
ВЫХОД: PRD_READY ✓ → Переход к /research
```

### 5.2 Команда /research

```
┌──────────────────────────────────────────────────────────────────────────┐
│                          КОМАНДА /research                               │
│                       Агент: Исследователь                               │
└──────────────────────────────────────────────────────────────────────────┘

ВХОД: PRD_READY (после /idea)
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 1. ЗАГРУЗКА ДОКУМЕНТАЦИИ                                                 │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. .claude/agents/researcher.md                                        │
│   2. .claude/commands/research.md                                        │
│   3. roles/researcher/codebase-analysis.md                               │
│   4. roles/researcher/pattern-identification.md                          │
│   5. roles/researcher/constraint-identification.md                       │
│   6. roles/researcher/pipeline-refinement.md                             │
│   7. docs/prd/{name}-prd.md        ← Созданный PRD                       │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 2. АНАЛИЗ КОДОВОЙ БАЗЫ                                                   │
├──────────────────────────────────────────────────────────────────────────┤
│ Для CREATE режима:                                                       │
│   • Анализирует templates/                                               │
│   • Изучает knowledge/                                                   │
│                                                                          │
│ Для FEATURE режима:                                                      │
│   • Анализирует services/                                                │
│   • Изучает существующие модели                                          │
│   • Ищет точки интеграции                                                │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 3. ВЫЯВЛЕНИЕ ПАТТЕРНОВ                                                   │
├──────────────────────────────────────────────────────────────────────────┤
│ Определяет:                                                              │
│   • Архитектурные паттерны                                               │
│   • Code patterns                                                        │
│   • Naming conventions                                                   │
│   • Существующие абстракции                                              │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 4. ВЫЯВЛЕНИЕ ОГРАНИЧЕНИЙ                                                 │
├──────────────────────────────────────────────────────────────────────────┤
│ Определяет:                                                              │
│   • Технические ограничения                                              │
│   • Зависимости                                                          │
│   • Конфликты                                                            │
│   • Риски реализации                                                     │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 5. УТОЧНЕНИЕ ПАЙПЛАЙНА                                                   │
├──────────────────────────────────────────────────────────────────────────┤
│ На основе анализа:                                                       │
│   • Определяет какие сервисы нужны                                       │
│   • Определяет какие шаблоны использовать                                │
│   • Формирует рекомендации для Архитектора                               │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 6. ПРОВЕРКА ВОРОТ RESEARCH_DONE                                          │
├──────────────────────────────────────────────────────────────────────────┤
│ Чек-лист:                                                                │
│   [ ] Код проанализирован                                                │
│   [ ] Паттерны выявлены                                                  │
│   [ ] Ограничения задокументированы                                      │
│   [ ] Рекомендации сформированы                                          │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
ВЫХОД: RESEARCH_DONE ✓ → Переход к /plan или /feature-plan
```

### 5.3 Команда /plan

```
┌──────────────────────────────────────────────────────────────────────────┐
│                            КОМАНДА /plan                                 │
│                         Агент: Архитектор                                │
│                 (для CREATE режима — новый проект)                       │
└──────────────────────────────────────────────────────────────────────────┘

ВХОД: RESEARCH_DONE (после /research)
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 1. ЗАГРУЗКА ДОКУМЕНТАЦИИ                                                 │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. .claude/agents/architect.md                                         │
│   2. .claude/commands/plan.md                                            │
│   3. roles/architect/architecture-design.md                              │
│   4. roles/architect/maturity-level-selection.md                         │
│   5. roles/architect/service-naming.md                                   │
│   6. roles/architect/implementation-plan.md                              │
│   7. roles/architect/api-contracts.md                                    │
│   8. knowledge/architecture/ddd-hexagonal.md                             │
│   9. knowledge/architecture/http-only-communication.md                   │
│  10. docs/prd/{name}-prd.md                                              │
│  11. docs/templates/architecture-template.md                             │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 2. ВЫБОР MATURITY LEVEL                                                  │
├──────────────────────────────────────────────────────────────────────────┤
│ Фреймворк использует только Level 2 (MVP):                               │
│   • Базовая инфраструктура                                               │
│   • Тестирование ≥75%                                                    │
│   • Один environment                                                     │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 3. ОПРЕДЕЛЕНИЕ СЕРВИСОВ                                                  │
├──────────────────────────────────────────────────────────────────────────┤
│ На основе PRD определяет:                                                │
│   • Business API (FastAPI) — какие?                                      │
│   • Data API (PostgreSQL/MongoDB) — какие?                               │
│   • Telegram Bot — нужен ли?                                             │
│   • Background Workers — какие?                                          │
│                                                                          │
│ Применяет naming convention:                                             │
│   {context}_{domain}_{type}                                              │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 4. ПРОЕКТИРОВАНИЕ АРХИТЕКТУРЫ                                            │
├──────────────────────────────────────────────────────────────────────────┤
│ Создаёт:                                                                 │
│   • C4 диаграммы (Context, Container)                                    │
│   • Диаграмму взаимодействия сервисов                                    │
│   • API контракты                                                        │
│   • Схему данных                                                         │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 5. ФОРМИРОВАНИЕ ПЛАНА                                                    │
├──────────────────────────────────────────────────────────────────────────┤
│ Создаёт: docs/architecture/{name}-plan.md                                │
│                                                                          │
│ Структура:                                                               │
│   1. Обзор архитектуры                                                   │
│   2. Компоненты системы                                                  │
│   3. Взаимодействие сервисов                                             │
│   4. API контракты                                                       │
│   5. Схема данных                                                        │
│   6. Инфраструктура                                                      │
│   7. Порядок реализации                                                  │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 6. УТВЕРЖДЕНИЕ ПОЛЬЗОВАТЕЛЕМ                                             │
├──────────────────────────────────────────────────────────────────────────┤
│ Представляет план пользователю:                                          │
│   • Показывает компоненты                                                │
│   • Объясняет решения                                                    │
│   • Ждёт подтверждения                                                   │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 7. ПРОВЕРКА ВОРОТ PLAN_APPROVED                                          │
├──────────────────────────────────────────────────────────────────────────┤
│ Чек-лист:                                                                │
│   [ ] План содержит все компоненты                                       │
│   [ ] Типы сервисов определены                                           │
│   [ ] API контракты описаны                                              │
│   [ ] Пользователь утвердил план                                         │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
ВЫХОД: PLAN_APPROVED ✓ → Переход к /generate
```

### 5.4 Команда /feature-plan

```
┌──────────────────────────────────────────────────────────────────────────┐
│                        КОМАНДА /feature-plan                             │
│                         Агент: Архитектор                                │
│                (для FEATURE режима — добавление фичи)                    │
└──────────────────────────────────────────────────────────────────────────┘

ВХОД: RESEARCH_DONE (после /research в FEATURE режиме)
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 1. ЗАГРУЗКА ДОКУМЕНТАЦИИ                                                 │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. .claude/agents/architect.md                                         │
│   2. .claude/commands/feature-plan.md                                    │
│   3. roles/architect/*.md                                                │
│   4. docs/prd/{name}-prd.md        ← Существующий PRD                    │
│   5. docs/architecture/{name}-plan.md ← Существующий план                │
│   6. services/                     ← Существующий код                    │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 2. АНАЛИЗ ВЛИЯНИЯ                                                        │
├──────────────────────────────────────────────────────────────────────────┤
│ Определяет:                                                              │
│   • Какие файлы будут модифицированы                                     │
│   • Какие новые файлы нужны                                              │
│   • Влияние на существующий API                                          │
│   • Backward compatibility                                               │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 3. ПРОЕКТИРОВАНИЕ РАСШИРЕНИЯ                                             │
├──────────────────────────────────────────────────────────────────────────┤
│ Определяет:                                                              │
│   • Новые эндпоинты API                                                  │
│   • Новые модели данных                                                  │
│   • Новая бизнес-логика                                                  │
│   • Изменения в существующих компонентах                                 │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 4. ФОРМИРОВАНИЕ ПЛАНА ФИЧИ                                               │
├──────────────────────────────────────────────────────────────────────────┤
│ Создаёт: docs/plans/{feature}-plan.md                                    │
│                                                                          │
│ Структура:                                                               │
│   1. Описание фичи                                                       │
│   2. Затронутые компоненты                                               │
│   3. Новые компоненты                                                    │
│   4. API изменения                                                       │
│   5. Миграции данных (если нужны)                                        │
│   6. Порядок реализации                                                  │
│   7. Тестовые сценарии                                                   │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 5. УТВЕРЖДЕНИЕ ПОЛЬЗОВАТЕЛЕМ                                             │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 6. ПРОВЕРКА ВОРОТ FEATURE_PLAN_APPROVED                                  │
├──────────────────────────────────────────────────────────────────────────┤
│ Чек-лист:                                                                │
│   [ ] План не нарушает существующую архитектуру                          │
│   [ ] Backward compatibility сохранена                                   │
│   [ ] Миграции спланированы                                              │
│   [ ] Пользователь утвердил план                                         │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
ВЫХОД: FEATURE_PLAN_APPROVED ✓ → Переход к /generate
```

### 5.5 Команда /generate

```
┌──────────────────────────────────────────────────────────────────────────┐
│                          КОМАНДА /generate                               │
│                        Агент: Реализатор                                 │
└──────────────────────────────────────────────────────────────────────────┘

ВХОД: PLAN_APPROVED или FEATURE_PLAN_APPROVED
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 1. ЗАГРУЗКА ДОКУМЕНТАЦИИ                                                 │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. .claude/agents/implementer.md                                       │
│   2. .claude/commands/generate.md                                        │
│   3. roles/implementer/infrastructure-setup.md                           │
│   4. roles/implementer/data-service.md                                   │
│   5. roles/implementer/business-api.md                                   │
│   6. roles/implementer/background-worker.md                              │
│   7. roles/implementer/telegram-bot.md                                   │
│   8. roles/implementer/testing.md                                        │
│   9. roles/implementer/logging.md                                        │
│  10. roles/implementer/nginx.md                                          │
│  11. conventions.md                                                      │
│  12. knowledge/services/                                                 │
│  13. knowledge/integrations/                                             │
│  14. templates/services/                                                 │
│  15. templates/shared/                                                   │
│  16. templates/infrastructure/                                           │
│  17. docs/architecture/{name}-plan.md или docs/plans/{feature}-plan.md   │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 2. ПОРЯДОК ГЕНЕРАЦИИ (CREATE режим)                                      │
├──────────────────────────────────────────────────────────────────────────┤
│ Шаг 2.1: Инфраструктура                                                  │
│   • docker-compose.yml                                                   │
│   • Makefile                                                             │
│   • .env.example                                                         │
│   • nginx/                                                               │
│                                                                          │
│ Шаг 2.2: Data API (ПЕРВЫМ!)                                              │
│   • services/{name}_data/                                                │
│   • Модели SQLAlchemy/Pydantic                                           │
│   • CRUD операции                                                        │
│   • Миграции                                                             │
│                                                                          │
│ Шаг 2.3: Business API                                                    │
│   • services/{name}_api/                                                 │
│   • Роутеры                                                              │
│   • Сервисы (HTTP клиенты к Data API)                                    │
│   • Dependency Injection                                                 │
│                                                                          │
│ Шаг 2.4: Telegram Bot (если нужен)                                       │
│   • services/{name}_bot/                                                 │
│   • Handlers                                                             │
│   • States (FSM)                                                         │
│                                                                          │
│ Шаг 2.5: Background Workers (если нужны)                                 │
│   • services/{name}_worker/                                              │
│   • Tasks                                                                │
│                                                                          │
│ Шаг 2.6: Тесты                                                           │
│   • tests/                                                               │
│   • pytest fixtures                                                      │
│   • conftest.py                                                          │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 3. ПОРЯДОК ГЕНЕРАЦИИ (FEATURE режим)                                     │
├──────────────────────────────────────────────────────────────────────────┤
│ Шаг 3.1: Миграции (если нужны)                                           │
│   • Новые модели в Data API                                              │
│   • Alembic миграции                                                     │
│                                                                          │
│ Шаг 3.2: Расширение Data API                                             │
│   • Новые CRUD методы                                                    │
│   • Новые эндпоинты                                                      │
│                                                                          │
│ Шаг 3.3: Расширение Business API                                         │
│   • Новые сервисы                                                        │
│   • Новые роутеры                                                        │
│                                                                          │
│ Шаг 3.4: Тесты новой функциональности                                    │
│   • Unit tests                                                           │
│   • Integration tests                                                    │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 4. ПРИМЕНЕНИЕ CONVENTIONS                                                │
├──────────────────────────────────────────────────────────────────────────┤
│ При генерации каждого файла:                                             │
│   [ ] Type hints для всех функций                                        │
│   [ ] Docstrings в Google-стиле (русский)                                │
│   [ ] snake_case для Python                                              │
│   [ ] async/await для I/O                                                │
│   [ ] HTTP-only доступ к данным                                          │
│   [ ] DRY — проверка дублирования                                        │
│   [ ] KISS — минимальная сложность                                       │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 5. ПРОВЕРКА ВОРОТ IMPLEMENT_OK                                           │
├──────────────────────────────────────────────────────────────────────────┤
│ Чек-лист:                                                                │
│   [ ] Все сервисы созданы по плану                                       │
│   [ ] Код соответствует conventions                                      │
│   [ ] Type hints присутствуют                                            │
│   [ ] Docstrings написаны                                                │
│   [ ] Базовые тесты проходят                                             │
│   [ ] Docker-compose работает                                            │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
ВЫХОД: IMPLEMENT_OK ✓ → Переход к /review
```

### 5.6 Команда /review

```
┌──────────────────────────────────────────────────────────────────────────┐
│                           КОМАНДА /review                                │
│                          Агент: Ревьюер                                  │
└──────────────────────────────────────────────────────────────────────────┘

ВХОД: IMPLEMENT_OK (после /generate)
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 1. ЗАГРУЗКА ДОКУМЕНТАЦИИ                                                 │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. .claude/agents/reviewer.md                                          │
│   2. .claude/commands/review.md                                          │
│   3. roles/reviewer/architecture-compliance.md                           │
│   4. roles/reviewer/convention-compliance.md                             │
│   5. roles/reviewer/review-report.md                                     │
│   6. conventions.md                                                      │
│   7. docs/architecture/{name}-plan.md                                    │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 2. ПРОВЕРКА АРХИТЕКТУРЫ                                                  │
├──────────────────────────────────────────────────────────────────────────┤
│ Проверяет:                                                               │
│   [ ] HTTP-only между сервисами                                          │
│   [ ] DDD/Hexagonal структура                                            │
│   [ ] Разделение ответственности                                         │
│   [ ] Нет прямого доступа к БД из Business                               │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 3. ПРОВЕРКА CONVENTIONS                                                  │
├──────────────────────────────────────────────────────────────────────────┤
│ Проверяет:                                                               │
│   [ ] Type hints везде                                                   │
│   [ ] Docstrings в Google-стиле                                          │
│   [ ] snake_case naming                                                  │
│   [ ] async/await правильно                                              │
│   [ ] Error handling                                                     │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 4. ПРОВЕРКА БЕЗОПАСНОСТИ                                                 │
├──────────────────────────────────────────────────────────────────────────┤
│ Проверяет:                                                               │
│   [ ] Нет hardcoded secrets                                              │
│   [ ] Input validation                                                   │
│   [ ] SQL injection защита                                               │
│   [ ] CORS настроен                                                      │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 5. КЛАССИФИКАЦИЯ ISSUES                                                  │
├──────────────────────────────────────────────────────────────────────────┤
│ Категории:                                                               │
│   🔴 BLOCKER — останавливает релиз                                       │
│   🟠 CRITICAL — требует немедленного исправления                         │
│   🟡 MAJOR — важное улучшение                                            │
│   🟢 MINOR — незначительное улучшение                                    │
│   ℹ️  INFO — информация/предложение                                      │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 6. ФОРМИРОВАНИЕ ОТЧЁТА                                                   │
├──────────────────────────────────────────────────────────────────────────┤
│ Создаёт: docs/reports/review-report.md                                   │
│                                                                          │
│ Структура:                                                               │
│   1. Сводка (количество issues по категориям)                            │
│   2. Blockers (если есть)                                                │
│   3. Critical Issues (если есть)                                         │
│   4. Major Issues                                                        │
│   5. Minor Issues                                                        │
│   6. Рекомендации                                                        │
│   7. Заключение: PASSED / FAILED                                         │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 7. ИСПРАВЛЕНИЕ ISSUES (если FAILED)                                      │
├──────────────────────────────────────────────────────────────────────────┤
│ Если есть Blockers или Critical:                                         │
│   • Реализатор исправляет                                                │
│   • Повторный review                                                     │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 8. ПРОВЕРКА ВОРОТ REVIEW_OK                                              │
├──────────────────────────────────────────────────────────────────────────┤
│ Чек-лист:                                                                │
│   [ ] 0 blockers                                                         │
│   [ ] 0 critical issues                                                  │
│   [ ] Все замечания исправлены или приняты                               │
│   [ ] Отчёт ревью создан                                                 │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
ВЫХОД: REVIEW_OK ✓ → Переход к /test
```

### 5.7 Команда /test

```
┌──────────────────────────────────────────────────────────────────────────┐
│                            КОМАНДА /test                                 │
│                            Агент: QA                                     │
└──────────────────────────────────────────────────────────────────────────┘

ВХОД: REVIEW_OK (после /review)
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 1. ЗАГРУЗКА ДОКУМЕНТАЦИИ                                                 │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. .claude/agents/qa.md                                                │
│   2. .claude/commands/test.md                                            │
│   3. roles/qa/test-scenarios.md                                          │
│   4. roles/qa/test-execution.md                                          │
│   5. roles/qa/coverage-verification.md                                   │
│   6. roles/qa/qa-report.md                                               │
│   7. docs/prd/{name}-prd.md        ← Требования для проверки             │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 2. ПОДГОТОВКА ТЕСТОВ                                                     │
├──────────────────────────────────────────────────────────────────────────┤
│ Проверяет:                                                               │
│   • Все тестовые файлы существуют                                        │
│   • Fixtures настроены                                                   │
│   • conftest.py корректен                                                │
│   • pytest.ini настроен                                                  │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 3. ЗАПУСК ТЕСТОВ                                                         │
├──────────────────────────────────────────────────────────────────────────┤
│ Выполняет:                                                               │
│   pytest --cov=services --cov-report=term-missing -v                     │
│                                                                          │
│ Собирает:                                                                │
│   • Количество passed/failed/skipped                                     │
│   • Coverage percentage                                                  │
│   • Uncovered lines                                                      │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 4. АНАЛИЗ ПОКРЫТИЯ                                                       │
├──────────────────────────────────────────────────────────────────────────┤
│ Проверяет:                                                               │
│   • Coverage ≥ 75%?                                                      │
│   • Критические пути покрыты?                                            │
│   • Edge cases покрыты?                                                  │
│                                                                          │
│ Если coverage < 75%:                                                     │
│   • Идентифицирует непокрытые модули                                     │
│   • Добавляет тесты                                                      │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 5. ТЕСТИРОВАНИЕ ПО ТРЕБОВАНИЯМ                                           │
├──────────────────────────────────────────────────────────────────────────┤
│ Для каждого FR из PRD:                                                   │
│   [ ] Есть тест?                                                         │
│   [ ] Тест проходит?                                                     │
│   [ ] Тест покрывает все сценарии?                                       │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 6. ФОРМИРОВАНИЕ QA ОТЧЁТА                                                │
├──────────────────────────────────────────────────────────────────────────┤
│ Создаёт: docs/reports/qa-report.md                                       │
│                                                                          │
│ Структура:                                                               │
│   1. Сводка (passed/failed/coverage)                                     │
│   2. Детали по модулям                                                   │
│   3. Failed tests (если есть)                                            │
│   4. Покрытие требований                                                 │
│   5. Рекомендации                                                        │
│   6. Заключение: PASSED / FAILED                                         │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 7. ПРОВЕРКА ВОРОТ QA_PASSED                                              │
├──────────────────────────────────────────────────────────────────────────┤
│ Чек-лист:                                                                │
│   [ ] Coverage ≥ 75%                                                     │
│   [ ] Все тесты проходят                                                 │
│   [ ] Нет критических багов                                              │
│   [ ] Все FR покрыты тестами                                             │
│   [ ] QA отчёт создан                                                    │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
ВЫХОД: QA_PASSED ✓ → Переход к /validate
```

### 5.8 Команда /validate

```
┌──────────────────────────────────────────────────────────────────────────┐
│                          КОМАНДА /validate                               │
│                         Агент: Валидатор                                 │
└──────────────────────────────────────────────────────────────────────────┘

ВХОД: QA_PASSED (после /test)
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 1. ЗАГРУЗКА ДОКУМЕНТАЦИИ                                                 │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. .claude/agents/validator.md                                         │
│   2. .claude/commands/validate.md                                        │
│   3. roles/validator/quality-gates.md                                    │
│   4. roles/validator/artifact-verification.md                            │
│   5. roles/validator/validation-report.md                                │
│   6. Все артефакты проекта                                               │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 2. ПРОВЕРКА ВСЕХ ВОРОТ                                                   │
├──────────────────────────────────────────────────────────────────────────┤
│ Проверяет статус каждых ворот:                                           │
│   [ ] PRD_READY — docs/prd/{name}-prd.md существует                      │
│   [ ] RESEARCH_DONE — анализ завершён                                    │
│   [ ] PLAN_APPROVED — docs/architecture/{name}-plan.md существует        │
│   [ ] IMPLEMENT_OK — services/ созданы                                   │
│   [ ] REVIEW_OK — docs/reports/review-report.md = PASSED                 │
│   [ ] QA_PASSED — docs/reports/qa-report.md = PASSED                     │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 3. ВЕРИФИКАЦИЯ АРТЕФАКТОВ                                                │
├──────────────────────────────────────────────────────────────────────────┤
│ Проверяет существование и корректность:                                  │
│                                                                          │
│ docs/                                                                    │
│ ├── prd/{name}-prd.md              [ ] Существует, заполнен              │
│ ├── architecture/{name}-plan.md    [ ] Существует, заполнен              │
│ └── reports/                                                             │
│     ├── review-report.md           [ ] Статус: PASSED                    │
│     └── qa-report.md               [ ] Статус: PASSED                    │
│                                                                          │
│ services/                                                                │
│ ├── {name}_api/                    [ ] Структура корректна               │
│ ├── {name}_data/                   [ ] Структура корректна               │
│ └── ...                            [ ] Тесты проходят                    │
│                                                                          │
│ docker-compose.yml                 [ ] Существует, валидный              │
│ Makefile                           [ ] Существует                        │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 4. СОЗДАНИЕ/ОБНОВЛЕНИЕ RTM                                               │
├──────────────────────────────────────────────────────────────────────────┤
│ Создаёт/обновляет: docs/rtm.md                                           │
│                                                                          │
│ Requirements Traceability Matrix:                                        │
│ | Req ID | Описание | Компонент | Реализация | Тест | Статус |           │
│ |--------|----------|-----------|------------|------|--------|           │
│ | FR-001 | ...      | API       | router.py  | test | Done   |           │
│ | FR-002 | ...      | Bot       | handler.py | test | Done   |           │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 5. ФОРМИРОВАНИЕ ОТЧЁТА ВАЛИДАЦИИ                                         │
├──────────────────────────────────────────────────────────────────────────┤
│ Создаёт: docs/reports/validation-report.md                               │
│                                                                          │
│ Структура:                                                               │
│   1. Статус ворот                                                        │
│   2. Артефакты проекта                                                   │
│   3. RTM сводка                                                          │
│   4. Готовность к деплою                                                 │
│   5. Заключение: ALL_GATES_PASSED / FAILED                               │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 6. ПРОВЕРКА ВОРОТ ALL_GATES_PASSED                                       │
├──────────────────────────────────────────────────────────────────────────┤
│ Чек-лист:                                                                │
│   [ ] PRD_READY ✓                                                        │
│   [ ] RESEARCH_DONE ✓                                                    │
│   [ ] PLAN_APPROVED ✓                                                    │
│   [ ] IMPLEMENT_OK ✓                                                     │
│   [ ] REVIEW_OK ✓                                                        │
│   [ ] QA_PASSED ✓                                                        │
│   [ ] Все артефакты существуют                                           │
│   [ ] RTM актуальна                                                      │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
ВЫХОД: ALL_GATES_PASSED ✓ → Переход к /deploy
```

### 5.9 Команда /deploy

```
┌──────────────────────────────────────────────────────────────────────────┐
│                           КОМАНДА /deploy                                │
│                         Агент: Валидатор                                 │
└──────────────────────────────────────────────────────────────────────────┘

ВХОД: ALL_GATES_PASSED (после /validate)
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 1. ЗАГРУЗКА ДОКУМЕНТАЦИИ                                                 │
├──────────────────────────────────────────────────────────────────────────┤
│ Читает:                                                                  │
│   1. .claude/commands/deploy.md                                          │
│   2. templates/infrastructure/docker-compose.yml                         │
│   3. templates/infrastructure/nginx/                                     │
│   4. knowledge/infrastructure/docker-compose.md                          │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 2. ПРОВЕРКА ГОТОВНОСТИ                                                   │
├──────────────────────────────────────────────────────────────────────────┤
│ Проверяет:                                                               │
│   [ ] docker-compose.yml существует и валиден                            │
│   [ ] Все Dockerfile существуют                                          │
│   [ ] .env файл создан                                                   │
│   [ ] Порты свободны                                                     │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 3. СБОРКА                                                                │
├──────────────────────────────────────────────────────────────────────────┤
│ Выполняет:                                                               │
│   make build                                                             │
│                                                                          │
│ Или напрямую:                                                            │
│   docker-compose build                                                   │
│                                                                          │
│ Проверяет:                                                               │
│   [ ] Все образы собраны успешно                                         │
│   [ ] Нет ошибок сборки                                                  │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 4. ЗАПУСК                                                                │
├──────────────────────────────────────────────────────────────────────────┤
│ Выполняет:                                                               │
│   make up                                                                │
│                                                                          │
│ Или напрямую:                                                            │
│   docker-compose up -d                                                   │
│                                                                          │
│ Проверяет:                                                               │
│   [ ] Все контейнеры запущены                                            │
│   [ ] Нет crashed контейнеров                                            │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 5. HEALTH CHECK                                                          │
├──────────────────────────────────────────────────────────────────────────┤
│ Выполняет:                                                               │
│   make health                                                            │
│                                                                          │
│ Или проверяет endpoints:                                                 │
│   curl http://localhost:8000/health                                      │
│   curl http://localhost:8001/health                                      │
│                                                                          │
│ Проверяет:                                                               │
│   [ ] API отвечает 200 OK                                                │
│   [ ] Data API отвечает 200 OK                                           │
│   [ ] Bot подключен (если есть)                                          │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 6. ПРОВЕРКА ЛОГОВ                                                        │
├──────────────────────────────────────────────────────────────────────────┤
│ Выполняет:                                                               │
│   make logs                                                              │
│                                                                          │
│ Или:                                                                     │
│   docker-compose logs --tail=100                                         │
│                                                                          │
│ Проверяет:                                                               │
│   [ ] Нет ERROR в логах                                                  │
│   [ ] Нет WARNING критических                                            │
│   [ ] Сервисы инициализированы                                           │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 7. БАЗОВЫЕ СЦЕНАРИИ                                                      │
├──────────────────────────────────────────────────────────────────────────┤
│ Проверяет:                                                               │
│   • Создание сущности                                                    │
│   • Получение сущности                                                   │
│   • Обновление сущности                                                  │
│   • Удаление сущности                                                    │
│   • Основной use-case проекта                                            │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────────────┐
│ 8. ПРОВЕРКА ВОРОТ DEPLOYED                                               │
├──────────────────────────────────────────────────────────────────────────┤
│ Чек-лист:                                                                │
│   [ ] Docker-контейнеры запущены                                         │
│   [ ] Health-check проходит                                              │
│   [ ] Базовые сценарии работают                                          │
│   [ ] Логи без ошибок                                                    │
└──────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
                        ┌─────────────┐
                        │   ГОТОВО!   │
                        │  DEPLOYED ✓ │
                        └─────────────┘
```

---

## 6. Оценка совместимости

### 6.1 Общая оценка

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    СОВМЕСТИМОСТЬ: 70%                                    │
│                                                                          │
│  ████████████████████████████████████░░░░░░░░░░░░░░░                     │
│                                                                          │
│  Совместимо:                    Требует адаптации:                       │
│  • Качественные ворота          • Navigation Matrix                     │
│  • Роли агентов                 • INDEX.md                              │
│  • Архитектурные принципы       • Deliverables catalog                  │
│  • Шаблоны сервисов             • Maturity Levels                       │
│  • DRY/KISS/YAGNI               • Stage conditions                      │
└─────────────────────────────────────────────────────────────────────────┘
```

### 6.2 Детальная оценка по аспектам

| Аспект | AIDD-MVP | .ai-framework | Совместимость |
|--------|----------|---------------|---------------|
| **Стадии** | 8 этапов | 7 стадий | 80% (похожи) |
| **Ворота** | 8 gates | Implicit | 70% |
| **Навигация** | Статическая | Dynamic Matrix | 50% |
| **Артефакты** | Разрозненные | Catalog | 60% |
| **Maturity** | Только L2 | L1-L4 | 40% |
| **Slash-команды** | 9 команд | Нет | 0% |
| **Шаблоны** | templates/ | Нет | 0% |
| **DDD/Hexagonal** | Да | Да | 100% |
| **HTTP-only** | Да | Да | 100% |
| **Верификация** | CLAUDE.md | CLAUDE.md | 100% |

### 6.3 Что можно интегрировать

1. **Navigation Matrix** → Добавить в workflow.md
2. **INDEX.md** → Создать docs/INDEX.md
3. **Deliverables Catalog** → Добавить в docs/reference/
4. **Stage Conditions** → Расширить качественные ворота
5. **LINKS_REFERENCE.md** → Создать для ссылок

### 6.4 Что нельзя интегрировать напрямую

1. **Maturity Levels 1, 3, 4** → AIDD-MVP всегда Level 2
2. **7-стадийный процесс** → Конфликт с 8-этапным
3. **P2P Lending пример** → Специфичен для .ai-framework

---

## 7. Детальное решение

### 7.1 Вариант A: Полная интеграция

**Описание**: Объединить оба фреймворка в единый

**Действия**:
```
1. Перенести из .ai-framework/ в основной проект:
   • docs/INDEX.md           ← Создать на основе .ai-framework/docs/INDEX.md
   • docs/reference/deliverables-catalog.md
   • docs/LINKS_REFERENCE.md ← Создать

2. Расширить workflow.md:
   • Добавить Navigation Matrix для каждой стадии
   • Добавить явные условия перехода

3. Обновить CLAUDE.md:
   • Объединить правила из обоих CLAUDE.md
   • Добавить ссылки на INDEX.md

4. Удалить .ai-framework/:
   • После переноса полезного контента
```

**Преимущества**:
- Единый источник истины
- Нет дублирования
- Чёткий порядок чтения

**Недостатки**:
- Значительная работа по миграции
- Риск потери функционала

**Оценка сложности**: ⭐⭐⭐⭐⭐ (5/5)

### 7.2 Вариант B: .ai-framework как расширение

**Описание**: Использовать .ai-framework только для специфичных сценариев

**Действия**:
```
1. Чётко разграничить области:
   • AIDD-MVP → Генерация MVP проектов
   • .ai-framework → Расширенное проектирование (Maturity 3-4)

2. Добавить переключатель:
   • В CLAUDE.md: "Для расширенных сценариев см. .ai-framework/"

3. Создать docs/framework-selection.md:
   • Когда использовать AIDD-MVP
   • Когда использовать .ai-framework
```

**Преимущества**:
- Минимальные изменения
- Оба фреймворка сохранены

**Недостатки**:
- Сложность выбора для AI
- Дублирование продолжается

**Оценка сложности**: ⭐⭐ (2/5)

### 7.3 Вариант C: Извлечение полезного (РЕКОМЕНДУЕТСЯ)

**Описание**: Извлечь из .ai-framework только недостающие компоненты

**Действия**:
```
ЭТАП 1: Создание недостающих файлов
────────────────────────────────────
1.1. Создать docs/INDEX.md
     • Индекс всей документации
     • Категоризация по темам
     • Ссылки на все .md файлы

1.2. Создать docs/LINKS_REFERENCE.md
     • Таблица всех внутренних ссылок
     • Алиасы для часто используемых путей

1.3. Создать docs/reference/deliverables-catalog.md
     • Каталог всех артефактов
     • Шаблоны для каждого артефакта
     • Критерии готовности

ЭТАП 2: Расширение workflow.md
────────────────────────────────────
2.1. Добавить Navigation Matrix
     | Стадия | Роль | Читает | Создаёт |
     |--------|------|--------|---------|
     | 1      | A    | X, Y   | Z       |

2.2. Добавить условия переходов
     • Явные критерии для каждых ворот
     • Fallback сценарии

ЭТАП 3: Обновление CLAUDE.md
────────────────────────────────────
3.1. Добавить раздел "Порядок чтения"
     • Точный порядок для каждой роли
     • Условные пути (CREATE vs FEATURE)

3.2. Добавить ссылки на INDEX.md
     • Как найти нужный документ
     • Как использовать LINKS_REFERENCE

ЭТАП 4: Решение о .ai-framework
────────────────────────────────────
4.1. Опция A: Оставить как справочник
     • Пометить как "advanced reference"
     • Не включать в основной поток

4.2. Опция B: Удалить
     • После извлечения всего полезного
     • Упростить структуру проекта
```

**Преимущества**:
- Минимальные изменения в основном проекте
- Получаем недостающий функционал
- Не ломаем существующий workflow

**Недостатки**:
- Нужно решить судьбу .ai-framework

**Оценка сложности**: ⭐⭐⭐ (3/5)

---

## 8. План действий

### 8.1 Немедленные действия (Вариант C)

```
┌─────────────────────────────────────────────────────────────────────────┐
│ ШАБЛОН ФАЙЛА: docs/INDEX.md                                             │
└─────────────────────────────────────────────────────────────────────────┘

# Индекс документации AIDD-MVP Generator

## Быстрый старт
- [CLAUDE.md](../CLAUDE.md) — Точка входа
- [workflow.md](../workflow.md) — 8-этапный процесс
- [conventions.md](../conventions.md) — Соглашения

## Роли агентов
- [Аналитик](.claude/agents/analyst.md)
- [Исследователь](.claude/agents/researcher.md)
- ...

## База знаний
- [Архитектура](knowledge/architecture/)
- [Сервисы](knowledge/services/)
- ...

## Шаблоны
- [Сервисы](templates/services/)
- [Инфраструктура](templates/infrastructure/)
- ...

## Отчёты
- [PRD](prd/)
- [Архитектура](architecture/)
- [Reports](reports/)
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│ РАСШИРЕНИЕ: workflow.md — Navigation Matrix                             │
└─────────────────────────────────────────────────────────────────────────┘

## Navigation Matrix

### Для роли: Аналитик

| Этап | Читает | Создаёт |
|------|--------|---------|
| /idea | CLAUDE.md, conventions.md, workflow.md | docs/prd/{name}-prd.md |
|       | .claude/agents/analyst.md | |
|       | roles/analyst/*.md | |
|       | knowledge/architecture/ | |
|       | docs/templates/prd-template.md | |

### Для роли: Исследователь

| Этап | Читает | Создаёт |
|------|--------|---------|
| /research | .claude/agents/researcher.md | (findings in memory) |
|           | roles/researcher/*.md | |
|           | docs/prd/{name}-prd.md | |
|           | templates/ | |

... (для каждой роли)
```

### 8.2 Checklist выполнения

```
[ ] 1. Создать docs/INDEX.md
[ ] 2. Создать docs/LINKS_REFERENCE.md
[ ] 3. Создать docs/reference/deliverables-catalog.md
[ ] 4. Добавить Navigation Matrix в workflow.md
[ ] 5. Обновить CLAUDE.md с ссылками на INDEX
[ ] 6. Решить судьбу .ai-framework/
[ ] 7. Обновить documentation-problems.md
[ ] 8. Валидировать все ссылки
```

### 8.3 Критерии успеха

1. **AI-агент может найти любой файл** за 2 шага:
   - CLAUDE.md → INDEX.md → нужный файл

2. **Пайплайн однозначен**:
   - Для каждой команды есть чёткий список файлов для чтения

3. **Нет дублирования**:
   - Один источник истины для каждой темы

4. **Ворота проверяемы**:
   - Каждые ворота имеют измеримые критерии

---

## История изменений

| Дата | Автор | Изменение |
|------|-------|-----------|
| 2025-12-20 | AI Agent | Создан документ |

---

## Связанные документы

| Документ | Описание |
|----------|----------|
| [documentation-problems.md](2025-12-20-documentation-problems.md) | Список всех проблем |
| [CLAUDE.md](../../CLAUDE.md) | Точка входа |
| [workflow.md](../../workflow.md) | 8-этапный процесс |
| [.ai-framework/AGENTS.md](../../.ai-framework/AGENTS.md) | 7-стадийный процесс |
