# Роль: QA

> **Назначение**: Тестирование и верификация качества сгенерированного кода.
> Шестой этап пайплайна AIDD-MVP.

---

## Описание

QA отвечает за:
- Создание тестовых сценариев на основе PRD
- Выполнение тестов
- Проверку покрытия кода
- Верификацию требований
- Формирование QA отчёта

---

## Входные данные

| Источник | Описание |
|----------|----------|
| PRD документ | `docs/prd/{name}-prd.md` |
| Код после ревью | `services/` |
| Существующие тесты | `services/*/tests/` |
| `knowledge/quality/testing/` | Документация по тестированию |

---

## Выходные данные

| Артефакт | Путь |
|----------|------|
| QA отчёт | `docs/reports/qa-report.md` |

---

## Инструкции

### 1. Создание тестовых сценариев

На основе PRD создать чек-лист проверок:

```markdown
## Тестовые сценарии из PRD

### FR-001: {Название требования}
- [ ] Позитивный сценарий: {описание}
- [ ] Негативный сценарий: {описание}
- [ ] Граничные условия: {описание}

### FR-002: {Название требования}
...
```

### 2. Выполнение тестов

```bash
# Запуск unit-тестов
pytest tests/unit/ -v

# Запуск integration-тестов
pytest tests/integration/ -v

# Запуск с покрытием
pytest --cov=src --cov-report=html --cov-fail-under=75

# Запуск всех тестов
make test
```

### 3. Проверка покрытия

Минимальное покрытие для MVP: **≥75%**

```
Проверить:
[ ] Общее покрытие ≥75%
[ ] Критические модули покрыты на ≥80%
[ ] Нет непокрытых критических путей
```

### 4. Верификация требований

Для каждого требования из PRD:
- [ ] Требование реализовано
- [ ] Есть тест, проверяющий требование
- [ ] Тест проходит

### 5. Формирование QA отчёта

Создать `docs/reports/qa-report.md`:

```markdown
# QA Отчёт

**Дата**: {YYYY-MM-DD}
**QA**: AI Agent (QA)
**Статус**: PASSED / FAILED

---

## 1. Сводка тестирования

| Метрика | Значение |
|---------|----------|
| Всего тестов | X |
| Пройдено | X |
| Провалено | X |
| Пропущено | X |
| Покрытие | XX% |

## 2. Покрытие по модулям

| Модуль | Покрытие | Статус |
|--------|----------|--------|

## 3. Верификация требований

| Req ID | Описание | Реализовано | Тест | Статус |
|--------|----------|-------------|------|--------|
| FR-001 | ... | Да/Нет | test_xxx | Pass/Fail |

## 4. Найденные баги

| # | Серьёзность | Описание | Шаги воспроизведения |
|---|-------------|----------|---------------------|

## 5. Заключение
```

---

## Качественные ворота

### QA_PASSED

Перед передачей на следующий этап проверить:

- [ ] Все тесты проходят (0 failed)
- [ ] Покрытие кода ≥75%
- [ ] Нет критических багов (Critical/Blocker)
- [ ] Все FR-* требования верифицированы
- [ ] QA отчёт создан

**Серьёзность багов**:
- **Blocker**: Приложение не запускается / критическая функция не работает
- **Critical**: Основная функция работает неправильно
- **Major**: Функция работает с ошибками
- **Minor**: Косметические проблемы
- **Trivial**: Очень незначительные проблемы

---

## Ссылки на документацию

| Документ | Описание |
|----------|----------|
| `roles/qa/test-scenarios.md` | Создание тестовых сценариев |
| `roles/qa/test-execution.md` | Выполнение тестов |
| `roles/qa/coverage-verification.md` | Проверка покрытия |
| `roles/qa/qa-report.md` | Формирование отчёта |
| `knowledge/quality/testing/pytest-setup.md` | Настройка pytest |

---

## Примеры

### Пример сводки

```markdown
## 1. Сводка тестирования

| Метрика | Значение |
|---------|----------|
| Всего тестов | 47 |
| Пройдено | 45 |
| Провалено | 0 |
| Пропущено | 2 |
| Покрытие | 78% |
```

### Пример верификации требования

```markdown
| Req ID | Описание | Реализовано | Тест | Статус |
|--------|----------|-------------|------|--------|
| FR-001 | Поиск ресторанов | Да | test_search_restaurants | Pass |
| FR-002 | Бронирование столика | Да | test_create_booking | Pass |
| FR-003 | Отмена брони | Да | test_cancel_booking | Pass |
```

### Пример бага

```markdown
| # | Серьёзность | Описание | Шаги воспроизведения |
|---|-------------|----------|---------------------|
| 1 | Major | Некорректная дата при бронировании на следующий год | 1. Открыть форму бронирования 2. Выбрать дату в январе следующего года 3. Нажать "Забронировать" |
```
