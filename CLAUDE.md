# CLAUDE.md — Главная точка входа для AI-агентов

> **Философия**: VERIFY BEFORE ACT — Проверяй перед действием.
> **Принцип**: Артефакты = Память. Не полагаемся на контекст чата.

---

## TL;DR (30 секунд)

| Вопрос | Ответ |
|--------|-------|
| **Что это?** | Фреймворк для генерации production-ready MVP за ~10 минут |
| **Как работает?** | 9-этапный пайплайн с качественными воротами |
| **Как начать?** | `/idea "описание проекта"` |
| **Результат** | Работающий MVP: FastAPI + PostgreSQL + Docker |

---

## Что такое AIDD-MVP Generator

**AIDD-MVP Generator** — фреймворк для быстрой генерации production-ready MVP проектов,
объединяющий методологию AI-Driven Development (AIDD) с архитектурными шаблонами.

### Ключевые характеристики

| Параметр | Значение |
|----------|----------|
| Уровень зрелости | **Level 2 (MVP)** — всегда |
| Покрытие тестами | ≥75% |
| Архитектура | DDD/Hexagonal, HTTP-only доступ к данным |
| Качественные ворота | 9 этапов (0-8), 9 ворот |
| Типы сервисов | Business API, Data API, Bot, Worker |

---

## Уникальность: Git Submodule подход

> **КЛЮЧЕВАЯ ИДЕЯ**: Фреймворк ≠ шаблон. Фреймворк = Knowledge Base.

```
┌────────────────────────────────────────────────────────────────────┐
│                    МОДЕЛЬ ИСПОЛЬЗОВАНИЯ                            │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  my-project/                    ← ЦЕЛЕВОЙ ПРОЕКТ (ваш код)         │
│  │                                                                 │
│  ├── .aidd/                     ← Git Submodule (ТОЛЬКО ЧТЕНИЕ!)   │
│  │   ├── CLAUDE.md              ← Инструкции                       │
│  │   ├── .claude/agents/        ← Роли AI                          │
│  │   ├── .claude/commands/      ← Slash-команды                    │
│  │   ├── templates/             ← Шаблоны сервисов                 │
│  │   └── knowledge/             ← База знаний                      │
│  │                                                                 │
│  ├── ai-docs/docs/              ← AI-ГЕНЕРИРУЕМЫЕ АРТЕФАКТЫ        │
│  │   ├── prd/{name}-prd.md                                         │
│  │   ├── architecture/{name}-plan.md                               │
│  │   └── reports/                                                  │
│  │                                                                 │
│  ├── services/                  ← AI-ГЕНЕРИРУЕМЫЙ КОД              │
│  │   ├── {context}_{domain}_api/                                   │
│  │   └── {context}_{domain}_data/                                  │
│  │                                                                 │
│  ├── .pipeline-state.json       ← Состояние пайплайна              │
│  └── docker-compose.yml         ← Инфраструктура                   │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
```

### Критическое правило

```
┌─────────────────────────────────────────────────────────────────┐
│  ⛔ НИКОГДА НЕ МОДИФИЦИРОВАТЬ ФАЙЛЫ В .aidd/                     │
├─────────────────────────────────────────────────────────────────┤
│  • Фреймворк = Knowledge Base (только чтение)                   │
│  • Весь код генерируется ВОВНЕ submodule                        │
│  • Для обновления: git submodule update --remote                │
└─────────────────────────────────────────────────────────────────┘
```

---

## Два режима работы

| Режим | Когда использовать | Отличия |
|-------|-------------------|---------|
| **CREATE** | Новый MVP с нуля | `/plan` → полная архитектура |
| **FEATURE** | Добавление фичи в существующий проект | `/feature-plan` → план интеграции |

### Автоопределение режима

| Признак | Режим |
|---------|-------|
| Есть `services/` или `docker-compose.yml` | **FEATURE** |
| Пустая директория | **CREATE** |

Явное переопределение: `/idea --mode=FEATURE "описание"`

---

## 9-этапный пайплайн

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         PIPELINE (этапы 0-8)                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────┐                                                           │
│  │  /init   │ Этап 0: Bootstrap                                         │
│  └────┬─────┘                                                           │
│       │ BOOTSTRAP_READY                                                 │
│       ▼                                                                 │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐          │
│  │  /idea   │───▶│/research │───▶│  /plan   │───▶│/generate │          │
│  │  Этап 1  │    │  Этап 2  │    │  Этап 3  │    │  Этап 4  │          │
│  └────┬─────┘    └────┬─────┘    └────┬─────┘    └────┬─────┘          │
│       │               │               │               │                 │
│  PRD_READY      RESEARCH_DONE    PLAN_APPROVED   IMPLEMENT_OK          │
│                                       ⚠️                                │
│                              Требует подтверждения                      │
│                                 пользователя!                           │
│                                                                         │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐          │
│  │ /review  │───▶│  /test   │───▶│/validate │───▶│ /deploy  │          │
│  │  Этап 5  │    │  Этап 6  │    │  Этап 7  │    │  Этап 8  │          │
│  └────┬─────┘    └────┬─────┘    └────┬─────┘    └────┬─────┘          │
│       │               │               │               │                 │
│  REVIEW_OK        QA_PASSED     ALL_GATES_PASSED   DEPLOYED            │
│                   (≥75% cov)                                            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### Таблица команд и ворот

| # | Этап | Команда | Агент | Ворота | Артефакт |
|---|------|---------|-------|--------|----------|
| 0 | Bootstrap | `/init` | — | `BOOTSTRAP_READY` | Структура ЦП |
| 1 | Идея | `/idea` | Аналитик | `PRD_READY` | `prd/{name}-prd.md` |
| 2 | Исследование | `/research` | Исследователь | `RESEARCH_DONE` | — |
| 3 | Архитектура | `/plan` | Архитектор | `PLAN_APPROVED` | `architecture/{name}-plan.md` |
| 4 | Реализация | `/generate` | Реализатор | `IMPLEMENT_OK` | `services/`, тесты |
| 5 | Ревью | `/review` | Ревьюер | `REVIEW_OK` | `reports/review-report.md` |
| 6 | QA | `/test` | QA | `QA_PASSED` | `reports/qa-report.md` |
| 7 | Валидация | `/validate` | Валидатор | `ALL_GATES_PASSED` | `rtm.md` |
| 8 | Деплой | `/deploy` | Валидатор | `DEPLOYED` | Работающее приложение |

### Принцип блокировки

```
❌ Ворота не пройдены → Переход на следующий этап ЗАБЛОКИРОВАН
✅ Ворота пройдены → Можно продолжать
```

**Пример**: Нельзя выполнить `/generate` без `PLAN_APPROVED`.

---

## 7 ролей AI-агентов

| Роль | Файл | Этапы | Ответственность |
|------|------|-------|-----------------|
| **Аналитик** | `.claude/agents/analyst.md` | 1 | PRD, требования |
| **Исследователь** | `.claude/agents/researcher.md` | 2 | Анализ кода/требований |
| **Архитектор** | `.claude/agents/architect.md` | 3 | Проектирование |
| **Реализатор** | `.claude/agents/implementer.md` | 4 | Генерация кода |
| **Ревьюер** | `.claude/agents/reviewer.md` | 5 | Качество кода |
| **QA** | `.claude/agents/qa.md` | 6 | Тестирование |
| **Валидатор** | `.claude/agents/validator.md` | 7-8 | Финальная проверка, деплой |

---

## Взаимодействие пользователя с фреймворком

```
┌─────────────────────────────────────────────────────────────────────┐
│  ПОЛЬЗОВАТЕЛЬ                           AI-АГЕНТ                    │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  1. Подключает .aidd/ как submodule                                 │
│  2. Запускает Claude Code                                           │
│                                                                     │
│  3. /idea "описание"            ───▶    Создаёт PRD                 │
│                                         Задаёт уточняющие вопросы   │
│                                                                     │
│  4. Отвечает на вопросы         ◀───    PRD_READY ✓                 │
│                                                                     │
│  5. /research                   ───▶    Анализирует                 │
│                                         RESEARCH_DONE ✓             │
│                                                                     │
│  6. /plan                       ───▶    Создаёт план архитектуры    │
│                                                                     │
│  7. ⚠️ УТВЕРЖДАЕТ ПЛАН          ◀───    Ждёт подтверждения          │
│     "Да, план утверждаю"                PLAN_APPROVED ✓             │
│                                                                     │
│  8. /generate                   ───▶    Генерирует код              │
│                                         IMPLEMENT_OK ✓              │
│                                                                     │
│  9. /review → /test → /validate ───▶    Проверяет качество          │
│                                         ALL_GATES_PASSED ✓          │
│                                                                     │
│  10. /deploy                    ───▶    Запускает приложение        │
│                                         DEPLOYED ✓                  │
│                                                                     │
│  🎉 MVP готов!                                                      │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## Архитектурные принципы

| Принцип | Правило |
|---------|---------|
| **HTTP-only** | Бизнес-сервисы НИКОГДА не обращаются к БД напрямую. Только через Data API. |
| **DDD/Hexagonal** | Разделение на `api/application/domain/infrastructure` |
| **Async-First** | Все I/O операции используют `async/await` |
| **Типобезопасность** | Полные type hints для всех функций |
| **Level 2 (MVP)** | Готов к продакшену, но без сложной масштабируемости |

### HTTP-only архитектура

```
┌─────────────┐      HTTP       ┌─────────────┐      SQL      ┌─────────┐
│ Business API│ ──────────────▶ │  Data API   │ ────────────▶ │   БД    │
│  (FastAPI)  │                 │  (FastAPI)  │               │(Postgres)│
└─────────────┘                 └─────────────┘               └─────────┘
      ▲
      │ HTTP
      │
┌─────────────┐
│  Telegram   │
│    Bot      │
└─────────────┘
```

---

## Критические правила (VERIFY BEFORE ACT)

```
┌─────────────────────────────────────────────────────────────────┐
│  ПЕРЕД ЛЮБЫМ ДЕЙСТВИЕМ AI ОБЯЗАН:                               │
├─────────────────────────────────────────────────────────────────┤
│  1. СОЗДАНИЕ ФАЙЛА  → Проверить, что файл НЕ существует         │
│  2. РЕДАКТИРОВАНИЕ  → Сначала прочитать текущее содержимое      │
│  3. УДАЛЕНИЕ        → Проверить все зависимости и ссылки        │
│  4. ДОБАВЛЕНИЕ ССЫЛКИ → Проверить, что цель существует          │
│  5. НАПИСАНИЕ КОДА  → Проверить нет ли похожего кода (DRY)      │
│  6. ДОБАВЛЕНИЕ ФИЧИ → Проверить, что это нужно СЕЙЧАС (YAGNI)   │
└─────────────────────────────────────────────────────────────────┘

НИКОГДА НЕ ПРЕДПОЛАГАТЬ → ВСЕГДА ПРОВЕРЯТЬ → ЗАТЕМ ДЕЙСТВОВАТЬ
```

---

## Порядок чтения для AI-агента

### При работе в целевом проекте (ЦП)

```
┌─────────────────────────────────────────────────────────────────────┐
│  ФАЗА 1: Контекст целевого проекта (СНАЧАЛА!)                       │
├─────────────────────────────────────────────────────────────────────┤
│  1. ./CLAUDE.md              ← Точка входа ЦП                       │
│  2. ./.pipeline-state.json   ← Состояние, режим, пройденные ворота  │
│  3. ./ai-docs/docs/          ← Существующие артефакты               │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│  ФАЗА 2: Проверка предусловий                                       │
├─────────────────────────────────────────────────────────────────────┤
│  4. Проверить требуемые ворота для команды                          │
│  5. Если не пройдены → сообщить пользователю                        │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│  ФАЗА 3: Инструкции фреймворка                                      │
├─────────────────────────────────────────────────────────────────────┤
│  6. .aidd/workflow.md        ← Процесс и ворота                     │
│  7. .aidd/.claude/commands/  ← Инструкции команды                   │
│  8. .aidd/.claude/agents/    ← Инструкции роли                      │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│  ФАЗА 4: Шаблоны (только если артефакт НЕ существует)               │
├─────────────────────────────────────────────────────────────────────┤
│  9. .aidd/templates/documents/  ← Шаблоны документов                │
│  10. .aidd/knowledge/           ← База знаний по теме               │
└─────────────────────────────────────────────────────────────────────┘
```

**Подробный алгоритм**: [docs/initialization.md](docs/initialization.md)

### При разработке самого фреймворка

```
CLAUDE.md → docs/INDEX.md → conventions.md → workflow.md
```

---

## Быстрый старт

### Новый проект (CREATE)

```bash
# 1. Создать проект и подключить фреймворк
mkdir my-mvp && cd my-mvp
git init
git submodule add https://github.com/your-org/aidd-mvp-generator.git .aidd

# 2. Запустить Claude Code
claude

# 3. Начать работу
/idea "Создать сервис бронирования столиков в ресторанах"

# 4. Следовать пайплайну
# /idea → /research → /plan → /generate → /review → /test → /validate → /deploy
```

### Добавление фичи (FEATURE)

```bash
cd existing-project
claude
/idea "Добавить систему email уведомлений"

# /idea → /research → /feature-plan → /generate → /review → /test → /validate → /deploy
```

---

## Типы генерируемых сервисов

| Тип | Шаблон | Порт | Описание |
|-----|--------|------|----------|
| **Business API** | `fastapi_business_api/` | 8000-8099 | REST API на FastAPI |
| **Data API (PostgreSQL)** | `postgres_data_api/` | 8001 | CRUD для PostgreSQL |
| **Data API (MongoDB)** | `mongo_data_api/` | 8002 | CRUD для MongoDB |
| **Telegram Bot** | `aiogram_bot/` | — | Бот на Aiogram |
| **Background Worker** | `asyncio_worker/` | — | Фоновые задачи |

### Именование сервисов

```
{контекст}_{домен}_{тип}

Примеры:
- finance_lending_api      — Business API
- finance_lending_data     — Data API
- finance_lending_bot      — Telegram Bot
```

---

## Структура фреймворка

```
aidd-mvp-generator/
│
├── CLAUDE.md              ← ВЫ ЗДЕСЬ — точка входа
├── conventions.md         ← Соглашения о коде и стиле
├── workflow.md            ← Описание 9-этапного процесса
│
├── .claude/               ← Интеграция Claude Code
│   ├── settings.json      ← Permissions и hooks
│   ├── agents/            ← 7 ролей AI-агентов
│   └── commands/          ← 10 slash-команд
│
├── roles/                 ← Детальные инструкции по ролям
├── knowledge/             ← База знаний (архитектура, сервисы, качество)
├── templates/             ← Шаблоны (сервисы, документы, инфраструктура)
└── docs/                  ← Документация генератора
```

**Полный индекс**: [docs/INDEX.md](docs/INDEX.md)

---

## Навигация по документации

| Ищу | Документ |
|-----|----------|
| Полный индекс файлов | [docs/INDEX.md](docs/INDEX.md) |
| Навигационная матрица | [docs/NAVIGATION.md](docs/NAVIGATION.md) |
| Алгоритм инициализации | [docs/initialization.md](docs/initialization.md) |
| 9-этапный процесс | [workflow.md](workflow.md) |
| Соглашения о коде | [conventions.md](conventions.md) |
| Структура целевого проекта | [docs/target-project-structure.md](docs/target-project-structure.md) |
| Инструкции роли | `.claude/agents/{role}.md` |
| Инструкции команды | `.claude/commands/{command}.md` |
| Шаблоны документов | `templates/documents/*.md` |
| Шаблоны сервисов | `templates/services/*/` |
| База знаний | `knowledge/` |

---

**Версия документа**: 2.0
**Обновлён**: 2025-12-21
**Назначение**: Главная точка входа для AI-агентов AIDD-MVP Generator
